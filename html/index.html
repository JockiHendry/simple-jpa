<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.0.preview.7">
<meta name="description" content="This guide is a documentation for simple-jpa plugin for Griffon.">
<meta name="keywords" content="simplejpa">
<title>simple-jpa 0.8</title>
<link rel="stylesheet" href="../stylesheets/simplejpadoc.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css">
<link rel="stylesheet" href="../stylesheets/coderay-asciidoctor.css">
<meta name="viewport" content="user-scalable=no">
</head>
<body class="article">
<div id="header">
<h1><i class="icon-reorder" id='nav-icon'></i> simple-jpa 0.8</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#getting-started">2. Getting Started</a></li>
<li><a href="#persistence">3. Persistence</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#setup">3.1. Setup</a></li>
<li><a href="#jpa-configurations">3.2. JPA Configurations</a></li>
<li><a href="#domain-class">3.3. Domain Class</a></li>
<li><a href="#persistence-methods">3.4. Persistence Methods</a></li>
</ul>
</li>
<li><a href="#scaffolding">4. Scaffolding</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#basic-generator">4.1. Basic Generator</a></li>
<li><a href="#ddd-generator">4.2. DDD Generator</a></li>
<li><a href="#customization">4.3. Customization</a></li>
</ul>
</li>
<li><a href="#validation">5. Validation</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#validation-method">5.1. Validation Method</a></li>
<li><a href="#notification-in-view">5.2. Notification In View</a></li>
<li><a href="#validation-message">5.3. Validation Message</a></li>
<li><a href="#miscellaneous">5.4. Miscellaneous</a></li>
</ul>
</li>
<li><a href="#view">6. View</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#custom-text-fields">6.1. Custom Text Fields</a></li>
<li><a href="#date-time-picker">6.2. Date Time Picker</a></li>
<li><a href="#table">6.3. Table</a></li>
<li><a href="#template-renderer">6.4. Template Renderer</a></li>
<li><a href="#dialog-utils">6.5. Dialog Utils</a></li>
</ul>
</li>
<li><a href="#transaction">7. Transaction</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#transaction-annotation">7.1. @Transaction Annotation</a></li>
<li><a href="#transaction-methods">7.2. Transaction Methods</a></li>
</ul>
</li>
<li><a href="#auditing">8. Auditing</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#auditable-domain-class">8.1. Auditable Domain Class</a></li>
<li><a href="#logged-user">8.2. Logged User</a></li>
<li><a href="#login-dialog">8.3. Login Dialog</a></li>
</ul>
</li>
<li><a href="#finders">9. Finders</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#query-methods">9.1. Query Methods</a></li>
<li><a href="#dynamic-finder">9.2. Dynamic Finder</a></li>
<li><a href="#dsl-finder">9.3. Dsl Finder</a></li>
<li><a href="#named-entity-graph">9.4. Named Entity Graph</a></li>
<li><a href="#query-configuration">9.5. Query Configuration</a></li>
</ul>
</li>
<li><a href="#testing">10. Testing</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#unit-test">10.1. Unit Test</a></li>
<li><a href="#integration-test">10.2. Integration Test</a></li>
</ul>
</li>
<li><a href="#script">Appendix A: Script</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#create-simple-jpa">A.1. create-simple-jpa</a></li>
<li><a href="#create-domain-class">A.2. create-domain-class</a></li>
<li><a href="#generate-all">A.3. generate-all</a></li>
<li><a href="#install-templates">A.4. install-templates</a></li>
<li><a href="#simple-jpa-console">A.5. simple-jpa-console</a></li>
<li><a href="#generate-schema">A.6. generate-schema</a></li>
<li><a href="#obfuscate">A.7. obfuscate</a></li>
<li><a href="#create-repository">A.8. create-repository</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>simple-jpa is a Griffon plugin for developing JPA and Swing based desktop application. The main goal of simple-jpa is
to allow developer to concentrate on business logic. simple-jpa provides much functionality that is needed when working
with JPA, therefore, frees developer from writing high-ceremony code.</p>
</div>
<div class="paragraph">
<p>simple-jpa is very useful for rapidly developing Swing-based database oriented desktop application. It can also be used
for prototyping.</p>
</div>
<div class="paragraph">
<p>The following is a list of some of simple-jpa’s features:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Scaffolding</dt>
<dd>
<p>simple-jpa can generate an MVCGroup based on a domain class. This will speed up development.</p>
</dd>
<dt class="hdlist1">Dynamic finders</dt>
<dd>
<p>simple-jpa injects dynamic finders to controllers (or services). With dynamic finders, developer can perform a query on
JPA entities (or domain objects) quickly and easily. simple-jpa also supports the execution of JPA named query, JPQL and
native SQL.</p>
</dd>
<dt class="hdlist1">Transaction management</dt>
<dd>
<p>Unlike web-based applications, desktop applications do not require Java Transaction API (JTA). simple-jpa automatically
provides and manages transaction for each method in controllers (can be configured by using annotation). By default,
simple-jpa will share EntityManager across transaction in a way that is suitable for desktop application.</p>
</dd>
<dt class="hdlist1">Bean Validation API (JSR-303) support</dt>
<dd>
<p>In the case of failed validation, simple-jpa will automatically present error messages in Swing-based view. Developer
can also configure error notification and its behavior.</p>
</dd>
<dt class="hdlist1">Common database application features</dt>
<dd>
<p>simple-jpa adds the following to all domain classes: an id (auto generated primary key), fields that store created time
and last modified time (will be filled automatically), and a soft delete flag (soft delete is marking the object as
inactive without deleting it from database).</p>
</dd>
<dt class="hdlist1">Swing nodes for database application</dt>
<dd>
<p>simple-jpa provides template renderer for effortlessly represent domain object in JTable, JList or JComboBox. It also
provides new nodes that can be used in Griffon’s view such as tagChooser, numberTextField, maskTextField, and
dateTimePicker.</p>
</dd>
<dt class="hdlist1">Integration testing</dt>
<dd>
<p>simple-jpa is using dbUnit in integration testing to fill database with predefined data from a Microsoft Excel file
(or csv file). This way, every test cases will be executed with the same table data.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This version is not compatible with Griffon 2.0.  You will need Griffon 1.5 and upgrade its Groovy version to at
least Groovy 2.3.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">2. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section will help you write your first simple-jpa application.  You should have installed JDK 7 and Griffon 1.5 if you haven&#8217;t done so.
You can find more information about Griffon&#8217;s installation in <a href="http://griffon.codehaus.org/guide/latest/guide/gettingStarted.html">http://griffon.codehaus.org/guide/latest/guide/gettingStarted.html</a>.</p>
</div>
<div class="paragraph">
<p>simple-jpa binary is compiled using Groovy 2.3 while the latest Griffon shipped with Groovy 2.2.  Unfortunately,
Groovy 2.3 binary is not backward compatible with previous version.  If you run simple-jpa in Griffon 1.5, you
 will encouter strange <code>Exception</code> such as <code>java.lang.NoClassDefFoundError: org/codehaus/groovy/runtime/typehandling/ShortTypeHandling</code>.
To fix this, you can either upgrade Griffon to use Groovy 2.3 or rebuild simple-jpa from source.  See <a href="http://www.jroller.com/aalmiray/entry/running_griffon_with_an_alternate">http://www.jroller.com/aalmiray/entry/running_griffon_with_an_alternate</a> for
 more information on upgrading Groovy used by Griffon.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
The article explains how to edit <code>griffon-cli-1.5.0.jar</code> by using CLI.  As an alternative, you can
also open <code>griffon-cli-1.5.0.jar</code> in 7zip, right click <code>build.properties</code> and select <em>Edit</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can execute the following command to determine Groovy version used by Griffon:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\&gt; griffon -v</pre>
</div>
</div>
<div class="paragraph">
<p>If Griffon has been setup properly, you are ready to create your first Griffon application:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\&gt; griffon create-app myapp</pre>
</div>
</div>
<div class="paragraph">
<p>Griffon creates and stores your new project in a folder named <code>myapp</code>.  You should move to this folder:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\&gt; cd myapp</pre>
</div>
</div>
<div class="paragraph">
<p>Install simple-jpa plugin by executing the following script:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\myapp&gt; griffon install-plugin simple-jpa</pre>
</div>
</div>
<div class="paragraph">
<p>The first thing to do when using simple-jpa is calling <code>create-simple-jpa</code> to setup persistence layer in your application.
 Don&#8217;t forget to make sure your database server is ready.  If you don&#8217;t have a database server installed in your computer,
 you can use Apache Derby as embedded database by executing the following script:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\myapp&gt; griffon create-simple-jpa -user=steven -password=12345 -database=C:/mydb -jdbc=derby-embedded</pre>
</div>
</div>
<div class="paragraph">
<p>You don&#8217;t need to install anything to use Apache Derby as embedded database because it is embedded in your application.
Your data will be stored in <code>C:\mydb</code>.  If you accidentally delete this folder, you need to recreate this folder by
appending <code>create=true</code> to JDBC URL in <code>griffon-app\conf\metainf\persistence.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:derby:C:/mydb;create=true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lets create your first domain classes:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\myapp&gt; griffon create-domain-class Invoice LineItem</pre>
</div>
</div>
<div class="paragraph">
<p>You can their properties and methods by changing the content of <code>Invoice.groovy</code> and <code>LineItem.groovy</code> in <code>C:\myapp\src\main\domain</code>:</p>
</div>
<div class="listingblock">
<div class="title">Invoice.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> domain

<span class="keyword">import</span> <span class="include">groovy.transform.*</span>
<span class="keyword">import</span> <span class="include">simplejpa.DomainClass</span>
<span class="keyword">import</span> <span class="include">javax.persistence.*</span>
<span class="keyword">import</span> <span class="include">org.hibernate.annotations.Type</span>
<span class="keyword">import</span> <span class="include">javax.validation.constraints.*</span>
<span class="keyword">import</span> <span class="include">org.hibernate.validator.constraints.*</span>
<span class="keyword">import</span> <span class="include">org.joda.time.*</span>

<span class="annotation">@DomainClass</span> <span class="annotation">@Entity</span> <span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">Invoice</span> {

  <span class="annotation">@NotBlank</span>
  <span class="predefined-type">String</span> number

  <span class="annotation">@NotNull</span> <span class="annotation">@Type</span>(type=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jadira.usertype.dateandtime.joda.PersistentLocalDate</span><span class="delimiter">&quot;</span></span>)
  LocalDate date

  <span class="annotation">@ElementCollection</span>(fetch=FetchType.EAGER) <span class="annotation">@NotEmpty</span>
  <span class="predefined-type">List</span>&lt;LineItem&gt; items = <span class="type">[]</span>

  <span class="type">void</span> add(LineItem item) {
    items &lt;&lt; item
  }

  <span class="predefined-type">BigDecimal</span> total() {
    items.sum { <span class="local-variable">it</span>.total() }
  }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">LineItem.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> domain

<span class="keyword">import</span> <span class="include">groovy.transform.*</span>
<span class="keyword">import</span> <span class="include">simplejpa.DomainClass</span>
<span class="keyword">import</span> <span class="include">javax.persistence.*</span>
<span class="keyword">import</span> <span class="include">org.hibernate.annotations.Type</span>
<span class="keyword">import</span> <span class="include">javax.validation.constraints.*</span>
<span class="keyword">import</span> <span class="include">org.hibernate.validator.constraints.*</span>
<span class="keyword">import</span> <span class="include">org.joda.time.*</span>

<span class="annotation">@Embeddable</span> <span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">LineItem</span> {

  <span class="annotation">@NotBlank</span> <span class="annotation">@Size</span>(min=<span class="integer">2</span>, max=<span class="integer">100</span>)
  <span class="predefined-type">String</span> productName

  <span class="annotation">@NotNull</span> <span class="annotation">@Min</span>(value=<span class="integer">1l</span>)
  <span class="predefined-type">Integer</span> qty

  <span class="annotation">@NotNull</span> <span class="annotation">@Min</span>(value=<span class="integer">0l</span>)
  <span class="predefined-type">BigDecimal</span> price

  <span class="predefined-type">BigDecimal</span> total() {
    qty * price
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, you can instruct simple-jpa to generate basic presentation layer (scaffolding):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\myapp&gt; griffon generate-all * -startupGroup=MainGroup</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you change your domain classes later, you can overwrite the generated code by calling:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\myapp&gt; griffon generate-all * -startupGroup=MainGroup -forceOverwrite</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Try to run your application:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\myapp&gt; griffon run-app</pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ve just created Swing-based Java application that uses JPA.  It is a working application!  You can add new record,
  edit or delete existing record.  You can search for existing records.  You can also double-click on table row to
  modify line items.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/getting_started.PNG" alt="getting started">
</div>
</div>
<div class="paragraph">
<p>If you close and re-run your application, tables will be recreated to reflect the latest change in domain classes.  You can
 disable this by remove the following line from <code>griffon-app/conf/metainf/persistence.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.schema-generation.database.action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">drop-and-create</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you think logger is too noisy, you change <code>log4j</code> configuration in <code>griffon-app/conf/Config.groovy</code> into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">log4j = {
   appenders {
      console <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">stdout</span><span class="delimiter">'</span></span>, <span class="key">layout</span>: pattern(<span class="key">conversionPattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">%d [%t] %-5p %c - %m%n</span><span class="delimiter">'</span></span>)
   }

   root {
      error <span class="string"><span class="delimiter">'</span><span class="content">stdout</span><span class="delimiter">'</span></span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if you close and re-run your application, existing records are still there because they&#8217;re persisted in <code>C:\mydb</code> by
  Apache Derby.</p>
</div>
<div class="paragraph">
<p>Want to learn more about programming with simple-jpa?  Close your application and execute the following script:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\myapp&gt; griffon simple-jpa-console</pre>
</div>
</div>
<div class="paragraph">
<p>This will launch Groovy Console where you can input Groovy code and execute them on the fly.  Click on <em>simple-jpa</em>,
<em>MVC Groups</em> in the menu bar and place a checkmark in <em>invoice</em> MVC group.  Type the following code and press Ctrl + R
to run it:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/getting_started_simple_jpa_console.PNG" alt="getting started simple jpa console">
</div>
</div>
<div class="paragraph">
<p>Try to delete existing code in Groovy console (without closing or relaunching a new console) and type a different one, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">invoiceController.findAllInvoice()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Press Ctrl + R to execute this script and the result will be displayed right away.  By using <code>simple-jpa-console</code>,
you easily test the result of finders or experiment on the right JP QL without relaunching your application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="persistence">3. Persistence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, simple-jpa uses Hibernate JPA as persistence layer for your application.  You have to execute <code>create-simple-jpa</code>
 to setup persistence layer in your application.  This is the first script you will need to execute when you start a
 new project.</p>
</div>
<div class="sect2">
<h3 id="setup">3.1. Setup</h3>
<div class="paragraph">
<p>In order to setup your persistence layer, you need to call <code>create-simple-jpa</code> script.  This is usually performed once
 for every new project.  <code>create-simple-jpa</code> will create database user and schema for you if they don&#8217;t exists.  Current version
  of simple-jpa only supports MySQL Server and Apache Derby Embedded setup.  If your database is not supported, you should
 configure your database manually.</p>
</div>
<div class="paragraph">
<p>If you use MySQL Server, you can execute <code>create-simple-jpa</code> like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon create-simple-jpa -user=steven -password=12345 -database=sample
   -provider=hibernate -jdbc=mysql -rootPassword=secret</pre>
</div>
</div>
<div class="paragraph">
<p>Because <code>hibernate</code> is default value for <code>-provider</code> and <code>mysql</code> is default value for <code>-jdbc</code>, you can ommit them:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon create-simple-jpa -user=steven -password=12345 -database=sample
   -rootPassword=secret</pre>
</div>
</div>
<div class="paragraph">
<p><code>create-simple-jpa</code> will check if <code>sample</code> database is exists or not.  If <em>sample</em> database doesn&#8217;t exists, it will be created.
  Because this operation requires root user and its password, you need to provide a value in <code>-rootPassword</code>.  This password
  won&#8217;t be saved in your application.  <code>create-simple-jpa</code> also creates new database user called <em>steven</em> with default password
  <em>12345</em> if it doesn&#8217;t exists yet.  This user will have full privilleges on <em>sample</em> database.</p>
</div>
<div class="paragraph">
<p>If you want to use Derby Embedded, you can execute <code>create-simple-jpa</code> like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon create-simple-jpa -user=steven -password=12345 -database=C:/Users/steven/mydb
  -jdbc=derby-embedded -rootPassword=secret</pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>-jdbc=derby-embedded</code>, it is better to use absolute path for <code>-database</code> value.  Derby embedded database will
be created at the specified location.  The draw back of using absolute path is you must make sure database is copied
 to the proper location when you distribute your application.</p>
</div>
<div class="paragraph">
<p>Root password is not required when using Derby embedded.  If you didn&#8217;t specify root password, <code>create-simple-jpa</code> will
create root user with password equals to user password (in this sample, it is <em>12345</em>).</p>
</div>
<div class="paragraph">
<p>In addition to setup your database, <code>create-simple-jpa</code> also performs the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create <code>griffon-app/conf/metainf/persistence.xml</code> that contains information required to connect to database, such as
JDBC URL, database username and password.</p>
</li>
<li>
<p>Create <code>griffon-app/conf/metainf/orm.xml</code> that register <code>AuditingEntityListener</code>.  This is required if you want to use
<a href="#auditing">Auditing</a> feature.</p>
</li>
<li>
<p>Create <code>griffon-app/i18n/ValidationMessages.properties</code>.  You can edit this file if you want to change <a href="#validation-message">Validation Message</a>.</p>
</li>
<li>
<p>Add dependencies to JPA provider and JDBC driver in <code>griffon-app/conf/BuildConfig.groovy</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want <code>create-simple-jpa</code> to perform the operations above without touching your database, use <code>-skipDatabase</code>
argument:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon create-simple-jpa -user=steven -password=12345 -database=sample -skipDatabase</pre>
</div>
</div>
<div class="paragraph">
<p>You can instruct your JPA provider to recreate database objects (tables) based on current domain classes by executing
  <code>generate-schema</code> script:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-schema -target=database -action=drop-and-create</pre>
</div>
</div>
<div class="paragraph">
<p>Rather than directly executing in target database, <code>generate-schema</code> can also store the generated SQL statements in a file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-schema -target=script -action=create -createTarget=mydatabase.sql</pre>
</div>
</div>
<div class="paragraph">
<p>The command above will create <code>mydatabase.sql</code> in current directory.  This file contains SQL statements to create
 tables required by your application.</p>
</div>
</div>
<div class="sect2">
<h3 id="jpa-configurations">3.2. JPA Configurations</h3>
<div class="paragraph">
<p>By default, JPA provider will read persistence layer configurations stored in <code>persistence.xml</code>.  The following is a
sample <code>persistence.xml</code> created by <code>create-simple-jpa</code> script:</p>
</div>
<div class="listingblock">
<div class="title">persistence.xml</div>
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;persistence</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transaction-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RESOURCE_LOCAL</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;provider&gt;</span>org.hibernate.jpa.HibernatePersistenceProvider<span class="tag">&lt;/provider&gt;</span>
    <span class="tag">&lt;class&gt;</span>domain.Product<span class="tag">&lt;/class&gt;</span>
    <span class="tag">&lt;class&gt;</span>domain.LineItem<span class="tag">&lt;/class&gt;</span>
    <span class="tag">&lt;class&gt;</span>domain.Invoice<span class="tag">&lt;/class&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.driver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mysql.jdbc.Driver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost/exercises</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.user</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">steven</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.connection.autocommit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.dialect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.dialect.MySQL5Dialect</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.connection.provider_class</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.c3p0.internal.C3P0ConnectionProvider</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.schema-generation.database.action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">drop-and-create</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jadira.usertype.autoRegisterUserTypes</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;/persistence-unit&gt;</span>
<span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add new or edit existing JPA configurations inside <code>&lt;properties/&gt;</code>.  For example, setting
<code>javax.persistence.schema-generation.database.action</code> to <code>drop-and-create</code> makes your JPA provider to recreate
 database tables everytime application is launched.  You may want to disable this to make application startup faster.  If
 you disable auto schema generation, you can still use <code>generate-schema</code> to create database tables manually.</p>
</div>
<div class="paragraph">
<p>In addition to <code>persistence.xml</code>, simple-jpa also reads JPA configurations stored in <code>Config.groovy</code> and external
 properties file.  If more than one property are found, simple-jpa uses the value based on the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuration passed as system properties (must start with <code>javax.persistence</code>) have the first priority.</p>
</li>
<li>
<p>Configuration stored in properties file have the first priority.</p>
</li>
<li>
<p>Configuration stored in <code>Config.groovy</code>.</p>
</li>
<li>
<p>Configuration stored in <code>persistence.xml</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following lines show a sample configurations added to <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon {
    simplejpa {
        entityManager {
            properties  {
                javax.persistence.jdbc.driver = <span class="string"><span class="delimiter">'</span><span class="content">com.mysql.jdbc.Driver</span><span class="delimiter">'</span></span>
                javax.persistence.jdbc.url = <span class="string"><span class="delimiter">'</span><span class="content">jdbc:mysql://localhost/mydatabase</span><span class="delimiter">'</span></span>
                javax.persistence.jdbc.user = <span class="string"><span class="delimiter">'</span><span class="content">scott</span><span class="delimiter">'</span></span>
                javax.persistence.jdbc.password = <span class="string"><span class="delimiter">'</span><span class="content">tiger</span><span class="delimiter">'</span></span>
                hibernate.connection.autocommit = <span class="string"><span class="delimiter">'</span><span class="content">false</span><span class="delimiter">'</span></span>
                hibernate.dialect = <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate.dialect.MySQL5Dialect</span><span class="delimiter">'</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The advantage of storing configurations in <code>Config.groovy</code> is you can have different JPA configurations per Griffon
 environments.  For example, the following configurations use different database for different environments:</p>
</div>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon {
  simplejpa {
    entityManager {
      properties {
        environments {
          development {
            javax.persistence.jdbc.url = <span class="string"><span class="delimiter">'</span><span class="content">jdbc:mysql://localhost/exercises</span><span class="delimiter">'</span></span>
            javax.persistence.jdbc.user = <span class="string"><span class="delimiter">'</span><span class="content">steven</span><span class="delimiter">'</span></span>
            javax.persistence.jdbc.password = <span class="string"><span class="delimiter">'</span><span class="content">12345</span><span class="delimiter">'</span></span>
          }
          test {
            javax.persistence.jdbc.url = <span class="string"><span class="delimiter">'</span><span class="content">jdbc:mysql://localhost/test</span><span class="delimiter">'</span></span>
            javax.persistence.jdbc.user = <span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>
            javax.persistence.jdbc.password = <span class="string"><span class="delimiter">'</span><span class="content">secret</span><span class="delimiter">'</span></span>
            javax.persistence.<span class="string"><span class="delimiter">'</span><span class="content">schema-generation</span><span class="delimiter">'</span></span>.database.action = <span class="string"><span class="delimiter">'</span><span class="content">drop-and-create</span><span class="delimiter">'</span></span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run the application by using command like <code>run-app</code>, it will activate <code>development</code> environment.  In this case, JPA
uses database <code>jdbc:mysql://localhost/exercises</code>.  If you activate <code>test</code> environment (for example by running <code>test-app</code>),
JPA uses database <code>jdbc:mysql://localhost/test</code>.  It also recreate tables in that database.</p>
</div>
<div class="paragraph">
<p>To avoid storing sensitive information such as JDBC URL, username dan password in your source code, you
  can take advantage of Griffon feature to include properties file from <code>Config.groovy</code>.  For example, if you store JPA
  configuration to <code>hibernate.properties</code>, you can add the following line to <code>Config.groovy</code> to include your properties file:</p>
</div>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon.config.locations = [<span class="string"><span class="delimiter">'</span><span class="content">classpath:hibernate.properties</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may want to configure your source code repository to make sure your properties file will never committed to public
server.</p>
</div>
<div class="paragraph">
<p>simple-jpa can also be configured to read JPA properties from external properties file.  You can define the location of this
properties file by adding the following line to <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon.simplejpa.entityManager.propertiesFile = <span class="string"><span class="delimiter">'</span><span class="content">C:/example/db.properties</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A sample <code>db.properties</code> will look like:</p>
</div>
<div class="listingblock">
<div class="title">C:/example/db.properties</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">javax.persistence.jdbc.url = <span class="string"><span class="delimiter">'</span><span class="content">jdbc:mysql://localhost/test</span><span class="delimiter">'</span></span>
javax.persistence.jdbc.user = <span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>
javax.persistence.jdbc.password = <span class="string"><span class="delimiter">'</span><span class="content">secret</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Configurations stored in this properties file will override existing configurations in <code>Config.groovy</code> and <code>persistence.xml</code>,
 but can be overriden by JVM system properties.  If you didn&#8217;t change <code>griffon.simplejpa.entityManager.propertiesFile</code>,
 it defaults to <code>simplejpa.properties</code>.  This means you can always override JPA configuration for existing distribution by
 adding a new file called <code>simplejpa.properties</code> in the same location when you launched the application.</p>
</div>
<div class="paragraph">
<p>simple-jpa supports obfuscating configuration value.  For example, if you want to store obfuscated version of <em>12345</em>, you
 need to execute the following command to retrieve its obsfuscated version:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon obfuscate -generate='12345'</pre>
</div>
</div>
<div class="paragraph">
<p>Then, you can use the obfuscated version for any value in any location (such as <code>Config.groovy</code>, properties file or
system propeties).  For example, you can add the following line to <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon {
  simplejpa {
    entityManager {
      properties {
        javax.persistence.jdbc.password = <span class="string"><span class="delimiter">'</span><span class="content">obfuscated:YUqF9w6l5lpvNyH+1tnJBg==</span><span class="delimiter">'</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
While obfuscation makes it harder for lay people to read your configuration file, it doesn&#8217;t actually increase
  your security.  Anyone can easily display the original string by executing <code>griffon obfuscate -reverse</code>.   You should
  never publish obfuscated value if you don&#8217;t want people to know the original value.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="domain-class">3.3. Domain Class</h3>
<div class="paragraph">
<p>simple-jpa provides persistence methods to deal with persistent domain class (marked by <code>@Entity</code>).  To create such
  entity, you can use <code>create-domain-class</code> script, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon create-domain-class Invoice LineItem</pre>
</div>
</div>
<div class="paragraph">
<p>The command creates two new classes: <code>domain.Invoice</code> and <code>domain.LineItem</code>.  It also add these classes to <code>persistence.xml</code>.
  You can change the default base packages for domain classes by setting <code>griffon.simplejpa.domain.package</code> in <code>Config.groovy</code>.</p>
</div>
<div class="paragraph">
<p>You can also specify subpackage when executing <code>create-domain-class</code>, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon create-domain-class sales.Invoice sales.LineItem inventory.Product</pre>
</div>
</div>
<div class="paragraph">
<p>The command creates three new classes: <code>domain.sales.Invoice</code>, <code>domain.sales.LineItem</code> and <code>domain.inventory.Product</code>.</p>
</div>
<div class="paragraph">
<p>Persistent domain classes in simple-jpa is a normal JPA entities.  Just like when using JPA in Java, you can
decorate JPA entity with JPA annotations such as <code>@Entity</code>, <code>@OneToMany</code>, <code>@ManyToMany</code>, <code>@ManyToOne</code> and others.
See JPA documentation for more information about JPA annotations.  The following show examples of persistent domain
classes in simple-jpa:</p>
</div>
<div class="listingblock">
<div class="title">Invoice.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> domain

<span class="comment">// import statements are not shown.</span>

<span class="annotation">@DomainClass</span> <span class="annotation">@Entity</span> <span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">Invoice</span> {

  <span class="annotation">@NotEmpty</span> <span class="annotation">@Size</span>(min=<span class="integer">5</span>, max=<span class="integer">5</span>)
  <span class="predefined-type">String</span> number


  <span class="annotation">@NotNull</span> <span class="annotation">@Type</span>(type=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jadira.usertype.dateandtime.joda.PersistentLocalDate</span><span class="delimiter">&quot;</span></span>)
  LocalDate date

  <span class="annotation">@ElementCollection</span> <span class="annotation">@OrderColumn</span> <span class="annotation">@NotEmpty</span>
  <span class="predefined-type">List</span>&lt;LineItem&gt; items = <span class="type">[]</span>

  <span class="type">void</span> add(LineItem item) {
    items &lt;&lt; item
  }

  <span class="predefined-type">BigDecimal</span> total() {
    items.sum { <span class="local-variable">it</span>.total() }
  }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">LineItem.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> domain

<span class="comment">// import statements are not shown.</span>

<span class="annotation">@Embeddable</span> <span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">LineItem</span> {

  <span class="annotation">@NotNull</span> <span class="annotation">@ManyToOne</span>
  Product product

  <span class="annotation">@NotNull</span> <span class="annotation">@Min</span>(<span class="integer">0l</span>)
  <span class="predefined-type">BigDecimal</span> price

  <span class="annotation">@NotNull</span> <span class="annotation">@Min</span>(<span class="integer">1l</span>)
  <span class="predefined-type">BigDecimal</span> qty

  <span class="predefined-type">BigDecimal</span> total() {
    price * qty
  }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Product.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> domain

<span class="comment">// import statements are not shown.</span>

<span class="annotation">@DomainClass</span> <span class="annotation">@Entity</span> <span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">Product</span> {

  <span class="annotation">@NotEmpty</span> <span class="annotation">@Size</span>(min=<span class="integer">2</span>, max=<span class="integer">50</span>)
  <span class="predefined-type">String</span> name

  <span class="annotation">@NotNull</span> <span class="annotation">@Min</span>(value=<span class="integer">1l</span>)
  <span class="predefined-type">BigDecimal</span> retailPrice

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@DomainClass</code> is special annotation provided by simple-jpa.  This annotation automatically adds the following property
 to the annotated class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@Id</span> <span class="annotation">@GeneratedValue</span>(strategy=GenerationType.TABLE)   <i class="conum" data-value="1"></i><b>(1)</b>
<span class="predefined-type">Long</span> id  <i class="conum" data-value="2"></i><b>(2)</b>

<span class="predefined-type">String</span> deleted = <span class="string"><span class="delimiter">'</span><span class="content">N</span><span class="delimiter">'</span></span>  <i class="conum" data-value="3"></i><b>(3)</b>

<span class="predefined-type">Date</span> createdDate   <i class="conum" data-value="4"></i><b>(4)</b>

<span class="predefined-type">String</span> createdBy   <i class="conum" data-value="4"></i><b>(4)</b>

<span class="predefined-type">Date</span> modifiedDate  <i class="conum" data-value="4"></i><b>(4)</b>

<span class="predefined-type">String</span> modifiedBy  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To change generation strategy, add desired strategy to <code>idGenerationStrategy</code> attribute.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@DomainClass(excludeId=true)</code> will not generate this property.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@DomainClass(excludeDeletedFlag=true)</code> will not generate this property.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>@DomainClass(excludeAuditing=true)</code> will not generate these properties.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You aren&#8217;t required to add <code>@DomainClass</code> to every persistent domain classes, but some features such as <a href="#auditing">Auditing</a> will
not work without the properties generated by <code>@DomainClass</code>.  Of course, you can still code by hand the required properties in
every entities.</p>
</div>
</div>
<div class="sect2">
<h3 id="persistence-methods">3.4. Persistence Methods</h3>
<div class="paragraph">
<p>To make it possible for Griffon&#8217;s  artifacts to manage domain classes, simple-jpa injects persistence methods to them.
By default, persistence methods are injected into controller, but you can change it by adding the following line to <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon.simplejpa.finders.injectInto = [ <span class="string"><span class="delimiter">'</span><span class="content">service</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">repository</span><span class="delimiter">'</span></span> ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration above will inject persistence methods to services and repositories.  Repository is a custom artifact type
provided by simple-jpa.  You can create a new repository by using <code>griffon create-repository</code>, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon create-repository MyRepository</pre>
</div>
</div>
<div class="paragraph">
<p>The script creates <code>MyRepository.groovy</code> in <code>griffon-app/repositories</code>.</p>
</div>
<div class="paragraph">
<p>To retrieve instance of repository, you can use code like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">def</span> myRepository = SimpleJpaUtil.instance.repositoryManager.findRepository(<span class="string"><span class="delimiter">'</span><span class="content">MyRepository</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a simple application, it is usually acceptable to inject persistence methods to controllers.  If you want a clear
 separation, you should inject persistence methods only to repositories.  You must add <code>@Transaction</code> annotation to
 the injected artifacts to enable <a href="#transaction">Transaction</a>.  Class generated by <code>create-repository</code> already has <code>@Transaction</code>,
 but Griffon&#8217;s controllers do not have <code>@Transaction</code> by default.</p>
</div>
<div class="paragraph">
<p>The following is list of persistence methods injected by simple-jpa:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>persist(entity)</code></p>
<div class="paragraph">
<p>Use this method to save new entity.  It is a shortcut for <code>entityManager.persist()</code>.</p>
</div>
</li>
<li>
<p><code>merge(entity)</code></p>
<div class="paragraph">
<p>Use this method to add detached entity to current EntityManager.  It is a shortcut for <code>entityManager.merge()</code>.</p>
</div>
</li>
<li>
<p><code>remove(entity)</code></p>
<div class="paragraph">
<p>Delete an entity.  It is a shortcut for <code>entityManager.remove()</code>.</p>
</div>
</li>
<li>
<p><code>softDelete(entity)</code></p>
<div class="paragraph">
<p>Set <code>deleted</code> property of an entity into <code>'Y'</code>.</p>
</div>
</li>
<li>
<p><code>validate(object)</code></p>
<div class="paragraph">
<p>See <a href="#validation">Validation</a> for more information.</p>
</div>
</li>
<li>
<p>Finders</p>
<div class="paragraph">
<p>See <a href="#finders">Finders</a> for more information.</p>
</div>
</li>
<li>
<p><code>getEntityManager()</code></p>
<div class="paragraph">
<p>Returns an <code>EntityManager</code> for current session.  This method can&#8217;t be renamed.</p>
</div>
</li>
<li>
<p>Transaction methods</p>
<div class="paragraph">
<p>See <a href="#transaction-methods">Transaction Methods</a> for more information.</p>
</div>
</li>
<li>
<p>All public methods of <code>EntityManager</code>.</p>
<div class="paragraph">
<p>simple-jpa exposes all public methods of <code>EntityManager</code> to injected class.  This means you can directly call methods such
as <code>lock()</code>, <code>refresh()</code>, or <code>detach()</code> in injected class.  For more information about <code>EntityManager</code>, see JPA documentation.
These methods can&#8217;t be renamed.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
All persistence methods are public so you can still call them from different class.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To avoid conflict with existing methods in injected class, simple-jpa can add prefix to persistence methods.  For example,
  you can add the following line to <code>Config.groovy</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon.simplejpa.finders.prefix = 'jpa'</pre>
</div>
</div>
<div class="paragraph">
<p>Now, every persistence methods that can be renamed will have <em>jpa</em> prefix.  For example, you have to execute <code>jpaPersist()</code>
 rather than <code>persist()</code>.</p>
</div>
<div class="paragraph">
<p>The easiest way to learn simple-jpa persistence methods is by using <code>simple-jpa-console</code> script:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon simple-jpa-console</pre>
</div>
</div>
<div class="paragraph">
<p>It will launch a Groovy console where you can write code snippet and see the result.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/simple_jpa_console.PNG" alt="simple jpa console">
</div>
</div>
<div class="paragraph">
<p>The main advantage of Groovy console is you can edit existing code and execute it directly by selecting <em>Script</em>, <em>Run</em> (Ctrl+R).
This is many times faster than relaunching application by using <code>griffon run-app</code>.  You will find Groovy console very useful
 in testing your code snippet or understanding the result of persistence methods.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scaffolding">4. Scaffolding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Scaffolding feature from simple-jpa can be used to generate MVC groups based on existing domain classes.  This is very
useful in the early phase of application development as it provides guide for further development.
Scaffolding can be invoked by using <code>generate-all</code> command or by enabling it in
<code>Config.groovy</code>.</p>
</div>
<div class="paragraph">
<p>For example, MVC groups for domain class <code>Student</code> can be generated by using the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all Student</pre>
</div>
</div>
<div class="paragraph">
<p>simple-jpa will search for definition of <code>Student</code> class based on information from <code>griffon-app/conf/metainf/persistence.xml</code>.
If it is found, simple-jpa will perform the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new <code>griffon-app/models/project/StudentModel.groovy</code> if it doesn&#8217;t exists.</p>
</li>
<li>
<p>Create a new <code>griffon-app/views/project/StudentView.groovy</code> if it doesn&#8217;t exists.</p>
</li>
<li>
<p>Create a new <code>griffon-app/controllers/project/StudentController.groovy</code> if it doesn&#8217;t exists.</p>
</li>
<li>
<p>Search for <code>student</code> MVC group.  If it doesn&#8217;t exists, create a new MVC group with the following content:</p>
<div class="listingblock">
<div class="title">Application.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="comment">// MVC Group for &quot;student&quot;</span>
<span class="string"><span class="delimiter">'</span><span class="content">student</span><span class="delimiter">'</span></span> {
    model      = <span class="string"><span class="delimiter">'</span><span class="content">project.StudentModel</span><span class="delimiter">'</span></span>
    view       = <span class="string"><span class="delimiter">'</span><span class="content">project.StudentView</span><span class="delimiter">'</span></span>
    controller = <span class="string"><span class="delimiter">'</span><span class="content">project.StudentController</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</li>
<li>
<p>Create a new <code>test/integration/project/StudentTest.groovy</code> if it doesn&#8217;t exists.</p>
</li>
<li>
<p>Create a new <code>data.xls</code> if it doesn&#8217;t exists.  Add a single empty sheet named as <code>student</code> to the Microsoft Excel
file.  This Excel file will act as data source when invoking <code>StudentTest.groovy</code>.  See <a href="#testing">Testing</a> for more
information.</p>
</li>
<li>
<p>Add messages to <code>griffon-app/i18n/messages.properties</code> if they don&#8217;t exists.</p>
</li>
<li>
<p>Add a generic exception handler in <code>griffon-app/conf/Events.groovy</code> if it doesn&#8217;t exists.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, simple-jpa will not modify the content of existing files.  To force simple-jpa to overwrite existing
files, add <code>-forceOverwrite</code> parameter when invoking <code>generate-all</code>.  For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all -forceOverwrite Student</pre>
</div>
</div>
<div class="paragraph">
<p>The default target package for generated MVC artifacts is <code>project</code>.  To use a different target package,
<code>-generatedPackage</code> should be passed when invoking <code>generate-all</code>.  For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all -generatedPackage=com.jocki.exercises Student</pre>
</div>
</div>
<div class="paragraph">
<p>The command will place generated MVC artifacts in <code>com.jocki.exercises</code> package and register the following MVC group:</p>
</div>
<div class="listingblock">
<div class="title">Application.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="comment">// MVC Group for &quot;student&quot;</span>
<span class="string"><span class="delimiter">'</span><span class="content">student</span><span class="delimiter">'</span></span> {
    model      = <span class="string"><span class="delimiter">'</span><span class="content">com.jocki.exercises.StudentModel</span><span class="delimiter">'</span></span>
    view       = <span class="string"><span class="delimiter">'</span><span class="content">com.jocki.exercises.StudentView</span><span class="delimiter">'</span></span>
    controller = <span class="string"><span class="delimiter">'</span><span class="content">com.jocki.exercises.StudentController</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>simple-jpa is smart enough to recognize package hierarchy in domain classes.  It will try to preserve the
source package hierarchy in the resulting MVC artifacts.  For example, if <code>Teacher</code> is located in <code>domain.staff</code>,
then the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all -generatedPackage=com.jocki.exercises Teacher</pre>
</div>
</div>
<div class="paragraph">
<p>will place the generated MVC artifacts in <code>com.jocki.exercises.staff</code> and register the following MVC group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="comment">// MVC Group for &quot;teacher&quot;</span>
<span class="string"><span class="delimiter">'</span><span class="content">teacher</span><span class="delimiter">'</span></span> {
    model      = <span class="string"><span class="delimiter">'</span><span class="content">com.jocki.exercises.staff.TeacherModel</span><span class="delimiter">'</span></span>
    view       = <span class="string"><span class="delimiter">'</span><span class="content">com.jocki.exercises.staff.TeacherView</span><span class="delimiter">'</span></span>
    controller = <span class="string"><span class="delimiter">'</span><span class="content">com.jocki.exercises.staff.TeacherController</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Griffon, startup group is the first MVC group to be instantiated and displayed.  By default, <code>generate-all</code> will
not modify the value of current startup group.  This behaviour can be changed by using <code>-setStartup</code> parameter.  If
<code>-setStartup</code> is passed to <code>generate-all</code>, the command will set startup group to the generated MVC group.  For
example, the following command will generate <code>teacher</code> MVC group and set it as startup group:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all -setStartup Teacher</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since 0.8, simple-jpa generates view as a panel.  Because the generated view doesn&#8217;t have top level container
such as <code>JFrame</code>, it can&#8217;t be displayed by itself.  The recommended way to present the view is by creating a
startup group that will act as top level container.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>simple-jpa can also create a dedicated startup group that serves as container for existing domain class
based MVC groups.  To generate a dedicated startup group, <code>-startupGroup</code> parameter should be used with
the startup group&#8217;s name as its value.  For example, the following command will generate <code>mainGroup</code> MVC group and set
 it as startup group:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all -startupGroup=MainGroup</pre>
</div>
</div>
<div class="paragraph">
<p>The generated startup group&#8217;s view has a toolbar to launch domain class based MVC groups.  It uses <code>MainTabbedPane</code> to display
 selected MVC group.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/default_startup_group.PNG" alt="default startup group">
</div>
</div>
<div class="paragraph">
<p>You can add a new tab to main group from any MVC group by using code like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">MainGroupView mainView = app.getMvcGroupManager()[<span class="string"><span class="delimiter">'</span><span class="content">mainGroup</span><span class="delimiter">'</span></span>].view
mainView.mainTab.addMVCTab(<span class="string"><span class="delimiter">'</span><span class="content">mvcGroupName</span><span class="delimiter">'</span></span>, [<span class="key">arg1</span>: param1], <span class="string"><span class="delimiter">&quot;</span><span class="content">Tab Caption</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>addMVCTab()</code> always create new MVC group and display it in a new tab.  This means you can have multiple unrelated instances of the
same MVC group.</p>
</div>
<div class="paragraph">
<p>Domain class based MVC group generation and startup group generation can also be combined in a single command execution.
For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all Teacher -startupGroup=MainGroup</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>New MVC groups may be generated in the future after startup group has been created.  These new MVC groups will not
appear in current startup group&#8217;s toolbar.  One of possible solutions is recreate the startup group by including
<code>-forceOverwrite</code> to overwrite existing startup group:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all -startupGroup=MainGroup -forceOverwrite</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>generate-all</code> can accept multiple domain classes separated by space.  For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all Student Teacher Classroom</pre>
</div>
</div>
<div class="paragraph">
<p>As a shortcut, <code>*</code> can be used as domain class name to generate all registered domain classes. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all *</pre>
</div>
</div>
<div class="paragraph">
<p>Since version 0.8, scaffolding in simple-jpa is performed by an instance of <code>Generator</code>.  The default generator
that shipped with simple-jpa is <code>simplejpa.scaffolding.generator.basic.BasicGenerator</code>.  To select another generator,
 add <code>-generator</code> parameter when invoking <code>generate-all</code>.  For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all -generator=my.custom.Generator *</pre>
</div>
</div>
<div class="paragraph">
<p>Parameters that have been discussed so far can also be stored in <code>Config.groovy</code>.  The following table lists all possible
 values that can be added to <code>Config.groovy</code>:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 1. Scaffolding Configuration</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Expected Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>griffon.simplejpa.scaffolding.auto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, scaffolding is always performed everytime application is launched.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>griffon.simplejpa.scaffolding.generator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full class name that is instance of <code>Generator</code>.  Default value is <code>simplejpa.scaffolding.generator.basic
.BasicGenerator</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>griffon.simplejpa.scaffolding.generatedPackage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of target package for MVC artifacts.  Default value is <code>project</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>griffon.simplejpa.scaffolding.startupGroup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of startup group.  If it is not defined, no startup group will be generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>griffon.simplejpa.scaffolding.ignoreLazy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, lazy attributes will be included in generated code.  Default value is <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>griffon.simplejpa.scaffolding.forceOverwrite</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true or `false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, existing files will be overwritten.  Default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>griffon.simplejpa.scaffolding.skipExcel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, not Excel file (for integration testing) will be created.  Default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>griffon.simplejpa.scaffolding.dateTimeStyle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'DEFAULT'</code>, <code>'SHORT'</code>, <code>'MEDIUM'</code>, <code>'LONG'</code>, or <code>'FULL'</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represent formatting styles for auditing properties that are instances of <code>java.util.Date</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>griffon.simplejpa.scaffolding.target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string that consists of domain class names or <code>'*'</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of domain classes to generate.  If <code>'*'</code>, all domain classes will be generated.  Default value is <code>'*'</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, the configurations below:</p>
</div>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon {
    simplejpa {
        scaffolding {
            generatedPackage = <span class="string"><span class="delimiter">'</span><span class="content">com.jocki.exercises</span><span class="delimiter">'</span></span>
            startupGroup = <span class="string"><span class="delimiter">'</span><span class="content">MainGroup</span><span class="delimiter">'</span></span>
            forceOverwrite = <span class="predefined-constant">true</span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is identical with executing the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all -generatedPackage=com.jocki.exercises -startupGroup=MainGroup -forceOverwrite *</pre>
</div>
</div>
<div class="paragraph">
<p>Another benefit of storing <code>generate-all</code> parameters as configuration keys is automatic scaffolding.  The scaffolding
process can be automated if <code>griffon.simplejpa.scaffolding.auto</code> is set to <code>true</code>.  For example, this configuration will
automatically run scaffolding process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon {
    simplejpa {
        scaffolding {
            auto = <span class="predefined-constant">true</span>
            startupGroup = <span class="string"><span class="delimiter">'</span><span class="content">MainGroup</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Automatic scaffolding will be performed whenever Griffon is compiling classes, such as when project is launched from
<code>griffon run-app</code> command.  Automatic scaffolding will not run in production when no class compilations being carried
out.</p>
</div>
<div class="sect2">
<h3 id="basic-generator">4.1. Basic Generator</h3>
<div class="paragraph">
<p>Basic generator is the default generator used by simple-jpa.  It supports the following attribute types in
domain class:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 2. Supported Attribute Types</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Type</th>
<th class="tableblock halign-left valign-top">SwingBuilder node</th>
<th class="tableblock halign-left valign-top">Class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code>, <code>Character</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>textField()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JTextField</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>checkBox()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JCheckbox</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Byte</code>, <code>Short</code>, <code>Integer</code>, <code>Long</code>, <code>Float</code>, <code>Double</code>, <code>BigInteger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>numberTextField()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JFormattedTextField</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BigDecimal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>decimalTextField()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JFormattedTextField</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateTime</code>, <code>LocalDateTime</code>, <code>LocalDate</code>, <code>LocalTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dateTimePicker()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateTimePicker</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Enum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>comboBox()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JComboBox</code> with <code>EnumComboBoxModel</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List</code>, <code>Set</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>button()</code> if relation is one-to-many or <code>tagChooser()</code> if relation is many-to-many</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JButton</code> or <code>TagChooser</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any Entity Object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>button()</code> if relation is one-to-one or <code>comboBox()</code> if relation is one-to-many</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JButton</code> or <code>JComboBox</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Basic generator doesn&#8217;t support native data types such as <code>int</code>, <code>float</code>, or <code>double</code> because they
are not nullable.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Basic generator will generate TODO comments in the generated code to provide information or warning to
 user.  It is safe to delete these TODO comments.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, the following domain class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@DomainClass</span> <span class="annotation">@Entity</span> <span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">Student</span> {

    <span class="predefined-type">String</span> name

    <span class="predefined-type">Integer</span> age

    <span class="annotation">@Type</span>(type = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jadira.usertype.dateandtime.joda.PersistentLocalDate</span><span class="delimiter">&quot;</span></span>)
    LocalDate birthDate

    <span class="predefined-type">Boolean</span> registered

    <span class="annotation">@Enumerated</span>
    GRADE grade

    <span class="annotation">@ManyToOne</span>
    Teacher teacher

    <span class="annotation">@ManyToMany</span>(cascade=CascadeType.ALL, fetch=FetchType.EAGER)
    <span class="predefined-type">List</span>&lt;Classroom&gt; classrooms = <span class="type">[]</span>

}

<span class="type">enum</span> GRADE {
    GRADE_1, GRADE_2, GRADE_3
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be generated as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/generated_view_basic_attributes.PNG" alt="generated view basic attributes">
</div>
</div>
<div class="paragraph">
<p>To create a new record, user should enter required values in the editing area and click the <em>'Save&#8217;</em> button.</p>
</div>
<div class="paragraph">
<p>To update existing record, user must first select a row in table, enter the updated values in the editing area, and
click the <em>'Save&#8217;</em> button.</p>
</div>
<div class="paragraph">
<p>To remove record from database, user must click the <em>'Delete&#8217;</em> button that will appear if table&#8217;s row is selected.</p>
</div>
<div class="paragraph">
<p>For domain class that have one-to-one association, basic generator generates a dialog to
create, edit or remove the related entity.  This feature requires cascading to be activated for the attribute.</p>
</div>
<div class="paragraph">
<p>For example, the following attribute declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@OneToOne</span>(cascade=CascadeType.ALL, orphanRemoval=<span class="predefined-constant">true</span>)
Teacher teacher</code></pre>
</div>
</div>
<div class="paragraph">
<p>is represented by <code>JButton</code> that if clicked will open a dialog that allows user to modify the related
 <code>Teacher</code>.
 If this button is clicked in create operation, the dialog can be used to create a new instance of <code>Teacher</code> entity:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/generated_view_one_to_one.png" alt="generated view one to one">
</div>
</div>
<div class="paragraph">
<p>If this button is clicked in update operation, the dialog can be used to update or delete existing <code>Teacher</code> entity:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/generated_view_one_to_one_update.png" alt="generated view one to one update">
</div>
</div>
<div class="paragraph">
<p>The naming convention for one-to-one MVC group and its artifact&#8217;s name is the target entity name
with <em>'AsPair&#8217;</em>  as suffix.  For example, if target entity is <code>Teacher</code>, basic generator generates
<code>TeacherAsPairModel</code>, <code>TeacherAsPairView</code>, and <code>TeacherAsPairController</code>.  They are not to be confused with the
standalone MVC group for <code>Teacher</code> such as <code>TeacherModel</code>, <code>TeacherView</code>, and <code>TeacherController</code> that may also exists
in the project (for example they are used for displaying list of <code>Teacher</code> in their own screen and <strong>not</strong> as popup).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
If the annotated attribute in the generated code doesn&#8217;t have <code>cascade</code> set to <code>CascadeType.ALL</code>,
<code>org.hibernate.TransientPropertyValueException</code> will be raised when saving the entity.  To fix this, either add a
proper cascading to object mapping or change the generated code to make it work without cascading.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Basic generator also treats <code>@Embedded</code> attributes as equivalent of one-to-one attributes.  For example, the
following mapping generates the same view as the previous one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@Embedded</span>
Teacher teacher</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
User can press ESC button as a shortcut to close popup dialog.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
User can press Enter or double click a selected row in table to display the first one-to-many or one-to-one
popup dialog in the view.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For one-to-many associations, basic generator also generates a dialog.  For example, the following attribute
declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@OneToMany</span>(cascade=CascadeType.ALL, orphanRemoval=<span class="predefined-constant">true</span>, fetch=FetchType.EAGER)
<span class="predefined-type">Set</span>&lt;Classroom&gt; classrooms = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;()</code></pre>
</div>
</div>
<div class="paragraph">
<p>is represented by <code>JButton</code> that if clicked will open a dialog that allows user to add or remove the list of
<code>Classroom</code> entities that are associated with current entity. If this button is clicked in create operation, the
dialog can be used to populate the collection with one or more <code>Classroom</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/generated_view_one_to_many.png" alt="generated view one to many">
</div>
</div>
<div class="paragraph">
<p>If this button is clicked in update operation, the dialog can be used to add new entity to the collection, edit
the value of entity in the collection, or remove an entity from the collection:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/generated_view_one_to_many_update.png" alt="generated view one to many update">
</div>
</div>
<div class="paragraph">
<p>The naming convention for one-to-many attribute is the target entity name with <em>'AsChild&#8217;</em>  as suffix.  For example, if
target entity is <code>Classroom</code>, basic generator generates <code>ClassroomAsChildModel</code>, <code>ClassroomAsChildView</code>, and
<code>ClassroomAsChildController</code>.  This is not to be confused with <code>ClassroomModel</code>, <code>ClassroomView</code> or
<code>ClassroomController</code> that may also exists in the project.</p>
</div>
<div class="paragraph">
<p>Basic generator will also treat <code>@ElementCollection</code> attributes as equivalent of one-to-many attributes. For
example, the following mapping creates the same view as the previous one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@ElementCollection</span>(fetch=FetchType.EAGER)
<span class="predefined-type">Set</span>&lt;Classroom&gt; classrooms = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;()</code></pre>
</div>
</div>
<div class="paragraph">
<p>For bidirectional associations, basic generator generates inverse attributes as labels because they are not editable.
 For example, the following domain classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@DomainClass</span> <span class="annotation">@Entity</span> <span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">Invoice</span> {

    <span class="predefined-type">String</span> number

    <span class="annotation">@OneToOne</span>(cascade=CascadeType.ALL, orphanRemoval=<span class="predefined-constant">true</span>)
    Delivery delivery

}

<span class="annotation">@DomainClass</span> <span class="annotation">@Entity</span> <span class="annotation">@Canonical</span>(excludes=<span class="string"><span class="delimiter">'</span><span class="content">invoice</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">Delivery</span> {

    <span class="predefined-type">String</span> ticketNumber

    <span class="annotation">@OneToOne</span>(mappedBy=<span class="string"><span class="delimiter">'</span><span class="content">delivery</span><span class="delimiter">'</span></span>)
    Invoice invoice

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be generated as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/generated_view_one_to_one_bidirectional.png" alt="generated view one to one bidirectional">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Don&#8217;t forget to add <code>excludes</code> to <code>@Canonical</code> in bidirectional association to avoid infinitive recursion!
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ddd-generator">4.2. DDD Generator</h3>
<div class="paragraph">
<p>simple-jpa also shipped with a DDD generator that can selected by using <code>-generator</code> parameter such as in the following
execution:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon generate-all -generator=simplejpa.scaffolding.generator.ddd.DDDGenerator *</pre>
</div>
</div>
<div class="paragraph">
<p>DDD generator rely on basic generator to perform most of its works.  It generates views that are identical to those
generated by basic generator.  The only distinction is this generator will move JPA related methods and database
transactions from controller into a separate repository.</p>
</div>
<div class="paragraph">
<p>For every <code>@Entity</code> annotated domain classes, DDD generator will create their corresponding repository classes.
simple-jpa supports a custom Griffon&#8217;s artifact called <code>repository</code>.  For example, if there is an entity called
<code>Student</code>, DDD generator will create a new repository called <code>StudentRepository</code> in <code>griffon-app/repositories</code>.  This
artifact is a singleton.  It is automatically injected into controller (and other Griffon&#8217;s artifacts) by defining
a variable such as <code>studentRepository</code>.</p>
</div>
<div class="paragraph">
<p>To retrieve all repositories, use <code>RepositoryManager.getRepositories()</code> such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">def</span> repositories = SimpleJpaUtil.instance.repositoryManager.repositories
println <span class="string"><span class="delimiter">&quot;</span><span class="content">All repositories: </span><span class="inline"><span class="inline-delimiter">$</span>repositories</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Repository artifact is lazy initialized.  This means it won&#8217;t be created if it is not used.  <code>RepositoryManager.findRepository()</code>
can be used to retrieve an instance of repository.  This method will create a new instance that will be reused later (singleton)
when it is called for the first time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">InvoiceRepository repository = SimpleJpaUtil.instance.repositoryManager.findRepository(<span class="string"><span class="delimiter">'</span><span class="content">Invoice</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>DDD generator disables dynamic methods in controller and adds dynamic methods to repository by adding the following line to <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon.simplejpa.finders.injectInto = [<span class="string"><span class="delimiter">'</span><span class="content">repository</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customization">4.3. Customization</h3>
<div class="paragraph">
<p>A generator usually has classes and multiple templates.  Reusable logic for view generation is stored in
classes.  They will be invoked by templates.  For example, the generator class is always available to template as <code>g</code>
variable.</p>
</div>
<div class="paragraph">
<p>The easiest way to customize a generator is to modify its template. <code>install-templates</code> command can be used to
install templates for simple-jpa built-in generator to current project:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon install-templates</pre>
</div>
</div>
<div class="paragraph">
<p>The command will copy template files to <code>src/templates/artifacts</code>.  The following is list of all template files used by
simple-jpa built-in generators:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 3. Template Files</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Generator</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaDomainClass.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create-domain-class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain class generation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaRepository.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repository for entity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartupModel.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic, DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Startup group&#8217;s model</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartupController.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic, DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Startup group&#8217;s controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartupView.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic, DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Startup group&#8217;s view</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaModel.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic, DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain-class based model</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaView.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic, DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain-class based view</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaController.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain-class based controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaDDDController.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain-class based controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaIntegrationTest.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic, DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integration test case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaPairModel.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic, DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">one-to-one popup model</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaPairView.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic, DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">one-to-one popup view</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaPairController.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">one-to-one popup controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaDDDPairController.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">one-to-one popup controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaChildModel.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic, DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">one-to-many popup model</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaChildView.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic, DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">one-to-many popup view</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaChildController.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">one-to-many popup controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleJpaDDDChildController.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DDD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">one-to-many popup controller</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>After these templates have been installed into current project, the next invocation of <code>generate-all</code> will be based on
them.</p>
</div>
<div class="paragraph">
<p>For a more complex customization, a new generator may be created.  The new generator can be extended from existing
generator or <code>simplejpa.scaffolding.generator.Generator</code>. All generators have the following important methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>generate(DomainClass domainClass)</code> will be invoked when generating files for individual domain class.</p>
</li>
<li>
<p><code>generateStartupGroup(Map&lt;String,DomainClass&gt; domainClasses)</code> will be invoked when generating startup group.</p>
</li>
<li>
<p><code>generateExtra(Map&lt;String,DomainClass&gt; domainClasses)</code> is an optional method that will be invoked after generating
files for individual domain class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the following is a sample declaration of custom generator that does nothing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> generator

<span class="keyword">import</span> <span class="include">simplejpa.scaffolding.DomainClass</span>
<span class="keyword">import</span> <span class="include">simplejpa.scaffolding.Scaffolding</span>
<span class="keyword">import</span> <span class="include">simplejpa.scaffolding.generator.basic.BasicGenerator</span>

<span class="type">class</span> <span class="class">MyGenerator</span> <span class="directive">extends</span> BasicGenerator {

    MyGenerator(Scaffolding scaffolding) {
        <span class="local-variable">super</span>(scaffolding)
    }

    <span class="annotation">@Override</span>
    <span class="type">void</span> generate(DomainClass domainClass) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Generating </span><span class="inline"><span class="inline-delimiter">${</span>domainClass.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="comment">// call super.generate(domainClass) for default operation (generating MVC artifacts)</span>
    }

    <span class="annotation">@Override</span>
    <span class="type">void</span> generateStartupGroup(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, DomainClass&gt; domainClasses) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Generating startup group...</span><span class="delimiter">&quot;</span></span>
    }

    <span class="annotation">@Override</span>
    <span class="type">void</span> generateExtra(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, DomainClass&gt; domainClasses) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Generating extra...</span><span class="delimiter">&quot;</span></span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following command will use the custom generator:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>griffon -generator=generator.MyGenerator *</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validation">5. Validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>simple-jpa uses Bean Validation API (JSR 303) for validation.  By default, it uses Hibernate Validator as Bean Validation
 API implementation.  The following are some of common annotations supported by Hibernate Validator:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 4. Bean Validation Constraints</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@NotNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the annotated value is not null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@NotBlank</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the annotated character sequence is not null and the trimmed length is greater than 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@NotEmpty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be used for Collection to check whether the annotated element is not null or empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Size(min,max)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks if the annotated element&#8217;s size is between min and max (inclusive).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Max(value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks whether the annotated value is less than or equal to the specified maximum.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Min(value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks whether the annotated value is higher than or equal to the specified minimum.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These annotations can be added to properties of domain class, for example:</p>
</div>
<div class="listingblock">
<div class="title">Invoice.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@Canonical</span>(excludes=<span class="string"><span class="delimiter">'</span><span class="content">lineItems</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">Invoice</span> {

    <span class="annotation">@NotBlank</span> <span class="annotation">@Size</span>(min=<span class="integer">10</span>, max=<span class="integer">10</span>)
    <span class="predefined-type">String</span> number

    <span class="annotation">@NotNull</span> <span class="annotation">@Type</span>(type=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jadira.usertype.dateandtime.joda.PersistentLocalDate</span><span class="delimiter">&quot;</span></span>)
    LocalDate date

    <span class="annotation">@ElementCollection</span> <span class="annotation">@OrderColumn</span> <span class="annotation">@NotEmpty</span>
    <span class="predefined-type">List</span>&lt;ItemFaktur&gt; lineItems = <span class="type">[]</span>

}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="validation-method">5.1. Validation Method</h3>
<div class="paragraph">
<p>You can use <code>validate()</code> method from injection enhanced artifact to validate an object.  The first argument for this
 method is an object that will be validated.  It is the only required argument.  <code>validate()</code> returns <code>true</code> if requested
 object is successfully validated or <code>false</code> if it failed.</p>
</div>
<div class="paragraph">
<p>For example, the following code will print error message to console if invoice object is not valid:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="comment">// The following code assumes that controller is injection enhanced.</span>
<span class="comment">// You can also choose to enabled injection to other artifact such as repository.</span>
<span class="keyword">if</span> (controller.validate(invoice)) {
   println <span class="string"><span class="delimiter">&quot;</span><span class="content">invoice is valid.</span><span class="delimiter">&quot;</span></span>
} <span class="keyword">else</span> {
   println <span class="string"><span class="delimiter">&quot;</span><span class="content">invoice is not valid.</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second parameter for <code>validate()</code> determine what validation group is in effect.  The default value is <code>Default</code> group.
To use a different group, you can pass the group class to <code>validate()</code>, for example:</p>
</div>
<div class="listingblock">
<div class="title">Invoice.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@Canonical</span>(excludes=<span class="string"><span class="delimiter">'</span><span class="content">lineItems</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">Invoice</span> {

    <span class="annotation">@NotBlank</span>(groups=[FirstStep,SecondStep])
    <span class="annotation">@Size</span>(min=<span class="integer">10</span>, max=<span class="integer">10</span>, groups=[FirstStep,SecondStep])
    <span class="predefined-type">String</span> number

    <span class="annotation">@NotNull</span>(groups=[FirstStep,SecondStep])
    <span class="annotation">@Type</span>(type=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jadira.usertype.dateandtime.joda.PersistentLocalDate</span><span class="delimiter">&quot;</span></span>)
    LocalDate date

    <span class="annotation">@ElementCollection</span> <span class="annotation">@OrderColumn</span> <span class="annotation">@NotEmpty</span>(groups=[SecondStep])
    <span class="predefined-type">List</span>&lt;ItemFaktur&gt; lineItems = <span class="type">[]</span>

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="comment">// empty line items is acceptable and treated as valid</span>
<span class="keyword">if</span> (!controller.validate(invoice, FirstStep)) {
    println <span class="string"><span class="delimiter">&quot;</span><span class="content">first step validation for invoice is not valid!</span><span class="delimiter">&quot;</span></span>
}

<span class="comment">// now, empty line items is not valid</span>
<span class="keyword">if</span> (!controller.validate(invoice, SecondStep)) {
   println <span class="string"><span class="delimiter">&quot;</span><span class="content">second step validation for invoice is not valid!</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The third parameter accepts an instance of view model (Griffon&#8217;s model).  Use this to present error in presentation
 layer by highlighting related view&#8217;s component.  See the next section for more information about error notification.</p>
</div>
</div>
<div class="sect2">
<h3 id="notification-in-view">5.2. Notification In View</h3>
<div class="paragraph">
<p>To help you in displaying information about failed validation, simple-jpa injects the following members to all view
models (model in MVC group):</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 5. Validation Members Available in View Model</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Members Declaration</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>def errors = new ConcurrentHashMap()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a bindable map that stores validation messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean hasError()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return <code>true</code> if <code>errors</code> is not empty.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All builder&#8217;s nodes also has a special <code>errorPath</code> attribute that can be used to represent associated validation path
(like property name of validated objects).  If <code>errors</code> contains key equals to <code>errorPath</code>, the respective
 component will be highlighted.</p>
</div>
<div class="paragraph">
<p>For example, the following code will highlight the first <code>JTextField</code>:</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    textField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">errorPath</span>: <span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>)
    textField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">errorPath</span>: <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyController.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">MyController</span> {

    <span class="keyword">def</span> model
    <span class="keyword">def</span> view

    <span class="type">void</span> mvcGroupInit(<span class="predefined-type">Map</span> args) {
       model.errors[<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">First name is not valid!</span><span class="delimiter">'</span></span>
    }

}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/highlight_component_on_error.PNG" alt="highlight component on error">
</div>
</div>
<div class="paragraph">
<p>When you start typing on the highlighted <code>JTextField</code>, its red background will disappear.  This also remove existing
 entry in <code>model.errors</code>.</p>
</div>
<div class="paragraph">
<p>By default, simple-jpa use red background to notify failed validation.  You can also create your own notification method by
 extending <code>ErrorNotification</code>.  For example, the following implementation of <code>ErrorNotification</code> will highlight
 border on error:</p>
</div>
<div class="listingblock">
<div class="title">MyErrorNotification.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="include">java.awt.Color</span>
<span class="keyword">import</span> <span class="include">javax.swing.*</span>
<span class="keyword">import</span> <span class="include">javax.swing.border.*</span>
<span class="keyword">import</span> <span class="include">simplejpa.validation.*</span>

<span class="type">class</span> <span class="class">MyErrorNotification</span> <span class="directive">extends</span> ErrorNotification {

  <span class="predefined-type">Border</span> highlightBorder = <span class="predefined-type">BorderFactory</span>.createLineBorder(<span class="predefined-type">Color</span>.RED)
  <span class="predefined-type">Border</span> normalBorder

  <span class="directive">public</span> MyErrorNotification(<span class="predefined-type">JComponent</span> node, ObservableMap errors, <span class="predefined-type">String</span> errorPath) {
    <span class="local-variable">super</span>(node, errors, errorPath)
    normalBorder = node.getBorder()
  }

  <span class="type">void</span> performNotification() {
    <span class="keyword">if</span> (errors[errorPath]) {
      node.setBorder(highlightBorder)
    } <span class="keyword">else</span> {
      node.setBorder(normalBorder)
    }
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To assign <code>MyErrorNotification</code> to a single component, you can use <code>errorNotification</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">textField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">errorPath</span>: <span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="key">errorNotification</span>: main.MyErrorNotification)</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/border_component_on_error.PNG" alt="border component on error">
</div>
</div>
<div class="paragraph">
<p>To use <code>MyErrorNotification</code> on all components, add the following line to <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon.simplejpa.validation.defaultErrorNotificationClass = <span class="string"><span class="delimiter">'</span><span class="content">main.MyErrorNotification</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The component responsible for removing error message is called <code>ErrorCleaner</code>.  The following table lists all
  implementations of <code>ErrorCleaner</code> by default:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 6. Default Implementation of ErrorCleaner</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Implementation</th>
<th class="tableblock halign-left valign-top">Activation Condition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JTextField</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JTextFieldErrorCleaner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When user typed in text box.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JComboBox</code>, <code>JCheckBox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JComboBoxErrorCleaner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When user changed selection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JButton</code>, <code>JRadioButton</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JRadioButton</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When user clicked the button.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JXDatePicker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JXDatePickerErrorCleaner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When user changes date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simplejpa.swing.DateTimePicker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateTimePickerErrorCleaner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When user changes selection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simplejpa.swing.TagChooser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TagChooserErrorCleaner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When user changes selection.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can create your own implementation by creating a new class that implements <code>ErrorCleaner</code>.  For example, the following
  implementation removes error notification after one second:</p>
</div>
<div class="listingblock">
<div class="title">MyErrorCleaner.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="include">simplejpa.validation.*</span>
<span class="keyword">import</span> <span class="include">javax.swing.*</span>
<span class="keyword">import</span> <span class="include">java.awt.event.ActionListener</span>

<span class="type">class</span> <span class="class">MyErrorCleaner</span> <span class="directive">implements</span> ErrorCleaner {

    <span class="type">void</span> addErrorCleaning(<span class="predefined-type">JComponent</span> component, ObservableMap errors, <span class="predefined-type">String</span> errorPath) {
        <span class="keyword">new</span> <span class="predefined-type">Timer</span>(<span class="integer">1000</span>, {
            errors.remove(errorPath)
        } <span class="keyword">as</span> <span class="predefined-type">ActionListener</span>).start()
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To register this <code>ErrorCleaner</code> for all <code>JTextField</code>, you can add the following line to <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon.simplejpa.validation.errorCleaners = [
  <span class="string"><span class="delimiter">'</span><span class="content">javax.swing.JTextField</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">main.MyErrorCleaner</span><span class="delimiter">'</span></span>
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to apply the new <code>ErrorCleaner</code> to all components, use <code>'*'</code> instead of <code>'javax.swing.JTextField</code> as key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon.simplejpa.validation.errorCleaners = [
  <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">main.MyErrorCleaner</span><span class="delimiter">'</span></span>
]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="validation-message">5.3. Validation Message</h3>
<div class="paragraph">
<p>If validation is failed, simple-jpa stores validation message for the failed paths in <code>model.errors</code>.  You can use values
 stored in <code>model.errors</code> to determine which paths have been failed and what are their corresponding messages. You can
 also change the default validation message by editing <code>griffon-app\i18n\ValidationMessage.properties</code>.</p>
</div>
<div class="paragraph">
<p>The following code shows how to retrieve validation messages:</p>
</div>
<div class="listingblock">
<div class="title">MyModel.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">import</span> <span class="include">groovy.beans.Bindable</span>
<span class="keyword">import</span> <span class="include">org.hibernate.validator.constraints.NotBlank</span>

<span class="type">class</span> <span class="class">MyModel</span> {

   <span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> firstName

   <span class="predefined-type">String</span> lastName

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    textField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">text</span>: bind(<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="key">target</span>: model), <span class="key">errorPath</span>: <span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>)
    textField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">text</span>: bind(<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="key">target</span>: model), <span class="key">errorPath</span>: <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>)
    button(<span class="string"><span class="delimiter">'</span><span class="content">Save</span><span class="delimiter">'</span></span>, <span class="key">actionPerformed</span>: controller.save)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyController.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">MyController</span> {

    <span class="keyword">def</span> model
    <span class="keyword">def</span> view

    <span class="keyword">def</span> save = {
        <span class="keyword">if</span> (validate(model)) {
            println <span class="string"><span class="delimiter">'</span><span class="content">Your input have been validated and passed.</span><span class="delimiter">'</span></span>
        } <span class="keyword">else</span> {
            println <span class="string"><span class="delimiter">'</span><span class="content">Validation failed!</span><span class="delimiter">'</span></span>
            model.errors.each { k, v -&gt;
                println <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>k</span><span class="content"> </span><span class="inline"><span class="inline-delimiter">$</span>v</span><span class="delimiter">&quot;</span></span>
            }
            <span class="comment">// This will display the following error message</span>
            <span class="comment">// if first name is blank:</span>
            <span class="comment">//</span>
            <span class="comment">// Validation failed!</span>
            <span class="comment">// firstName may not be empty</span>
            <span class="comment">//</span>
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to display validation mesage as <code>JLabel</code> in view, you can use <code>errorLabel()</code> node.  For example, you can
 change the previous view into:</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    textField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">text</span>: bind(<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="key">target</span>: model), <span class="key">errorPath</span>: <span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>)
    errorLabel(<span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>)
    textField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">text</span>: bind(<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="key">target</span>: model), <span class="key">errorPath</span>: <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>)
    errorLabel(<span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>)
    button(<span class="string"><span class="delimiter">'</span><span class="content">Save</span><span class="delimiter">'</span></span>, <span class="key">actionPerformed</span>: controller.save)
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/error_label.PNG" alt="error label">
</div>
</div>
<div class="paragraph">
<p><code>errorLabel()</code> is only visible if <code>model.errors</code> contains a key equals to its <code>errorPath</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="miscellaneous">5.4. Miscellaneous</h3>
<div class="paragraph">
<p>In some cases, validation may be failed because <code>JTextField</code> value in model is an empty <code>String</code> rather than null
value. To ensure consistent behaviour, simple-jpa can be configured to translate all empty <code>String</code> into null value
before performing validation. This feature is disabled by default. To enable it, add the following line to <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon.simplejpa.validation.convertEmptyStringToNull = <span class="predefined-constant">true</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="view">6. View</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To assist you in building presentation layer, simple-jpa provides several custom nodes that are typically
used in business application.  They can only be used if your presentation layer is Swing based and you are using
Groovy&#8217;s SwingBuilder (default in Griffon).</p>
</div>
<div class="sect2">
<h3 id="custom-text-fields">6.1. Custom Text Fields</h3>
<div class="paragraph">
<p>Use <code>numberTextField()</code> to bind text component with numeric property in view model.  For example:</p>
</div>
<div class="listingblock">
<div class="title">MyModel.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">MyModel</span> {

   <span class="annotation">@Bindable</span> <span class="predefined-type">Long</span> amount

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    numberTextField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">bindTo</span>: <span class="string"><span class="delimiter">'</span><span class="content">amount</span><span class="delimiter">'</span></span>)
    button(<span class="string"><span class="delimiter">'</span><span class="content">Process</span><span class="delimiter">'</span></span>, <span class="key">actionPerformed</span>: { println model.amount })
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to bind to a <code>BigDecimal</code> property in view model, you need to use <code>decimalTextField()</code>.  For example:</p>
</div>
<div class="listingblock">
<div class="title">MyModel.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">MyModel</span> {

   <span class="annotation">@Bindable</span> <span class="predefined-type">Long</span> amount

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    decimalTextField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">bindTo</span>: <span class="string"><span class="delimiter">'</span><span class="content">amount</span><span class="delimiter">'</span></span>)
    button(<span class="string"><span class="delimiter">'</span><span class="content">Process</span><span class="delimiter">'</span></span>, <span class="key">actionPerformed</span>: { println model.amount })
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>numberTextField()</code> and <code>decimalTextField()</code> generates a <code>JFormattedTextField</code>.  The default formatter used by
 them is <code>DecimalFormat.getNumberInstance()</code>.  You can use different formatter by using one of <code>'currency'</code>, <code>'percent'</code>,
  or <code>'integer'</code> as value for <code>type</code> attribute.  For example:</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    label(<span class="string"><span class="delimiter">'</span><span class="content">Default</span><span class="delimiter">'</span></span>)
    decimalTextField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">bindTo</span>: <span class="string"><span class="delimiter">'</span><span class="content">amount</span><span class="delimiter">'</span></span>)
    label(<span class="string"><span class="delimiter">'</span><span class="content">Currency</span><span class="delimiter">'</span></span>)
    decimalTextField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">bindTo</span>: <span class="string"><span class="delimiter">'</span><span class="content">amount</span><span class="delimiter">'</span></span>, <span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">currency</span><span class="delimiter">'</span></span>)
    label(<span class="string"><span class="delimiter">'</span><span class="content">Percent</span><span class="delimiter">'</span></span>)
    decimalTextField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">bindTo</span>: <span class="string"><span class="delimiter">'</span><span class="content">amount</span><span class="delimiter">'</span></span>, <span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">percent</span><span class="delimiter">'</span></span>)
    label(<span class="string"><span class="delimiter">'</span><span class="content">Integer</span><span class="delimiter">'</span></span>)
    decimalTextField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">bindTo</span>: <span class="string"><span class="delimiter">'</span><span class="content">amount</span><span class="delimiter">'</span></span>, <span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">integer</span><span class="delimiter">'</span></span>)
    button(<span class="string"><span class="delimiter">'</span><span class="content">Process</span><span class="delimiter">'</span></span>, <span class="key">actionPerformed</span>: { println model.amount })
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/number_format.PNG" alt="number format">
</div>
</div>
<div class="paragraph">
<p>You can also change the property of current formatter by using attribute name that starts with <code>nf</code> and followed by
formatter&#8217;s property name, for example:</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    label(<span class="string"><span class="delimiter">'</span><span class="content">Default</span><span class="delimiter">'</span></span>)
    decimalTextField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">bindTo</span>: <span class="string"><span class="delimiter">'</span><span class="content">amount</span><span class="delimiter">'</span></span>)
    label(<span class="string"><span class="delimiter">'</span><span class="content">Custom Formatter</span><span class="delimiter">'</span></span>)
    decimalTextField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">bindTo</span>: <span class="string"><span class="delimiter">'</span><span class="content">amount</span><span class="delimiter">'</span></span>,
      <span class="key">nfMinimumFractionDigits</span>: <span class="integer">3</span>, <span class="key">nfMinimumIntegerDigits</span>: <span class="integer">5</span>)
    button(<span class="string"><span class="delimiter">'</span><span class="content">Process</span><span class="delimiter">'</span></span>, <span class="key">actionPerformed</span>: { println model.amount })
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/custom_formatter.PNG" alt="custom formatter">
</div>
</div>
<div class="paragraph">
<p>If you want a <code>MaskFormatter</code>, you can use <code>maskTextField()</code>:</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    label(<span class="string"><span class="delimiter">'</span><span class="content">Default</span><span class="delimiter">'</span></span>)
    maskTextField(<span class="key">columns</span>: <span class="integer">20</span>, <span class="key">mask</span>: <span class="string"><span class="delimiter">'</span><span class="content">AAA-#####-##</span><span class="delimiter">'</span></span>, <span class="key">bindTo</span>: <span class="string"><span class="delimiter">'</span><span class="content">identifier</span><span class="delimiter">'</span></span>)
    button(<span class="string"><span class="delimiter">'</span><span class="content">Process</span><span class="delimiter">'</span></span>, <span class="key">actionPerformed</span>: { println model.identifier })
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/mask_text_field.PNG" alt="mask text field">
</div>
</div>
<div class="paragraph">
<p>In the sample above, mask <code>'AAA-####-##'</code> allows user to input number of letter for the first three characters.  The rests
 should be number.</p>
</div>
</div>
<div class="sect2">
<h3 id="date-time-picker">6.2. Date Time Picker</h3>
<div class="paragraph">
<p>You can use <code>dateTimePicker()</code> to allow user to input date or time (or both).  This component should be binded to date
data type from Joda Time library.  If you don&#8217;t need time input or binding to property that uses Joda Time type, you can
just use <code>JXDatePicker</code> from SwingX instead of this component.</p>
</div>
<div class="paragraph">
<p><code>dateVisible</code> or <code>timeVisible</code> of this component determine which input is visible.  By default, both values are <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    label(<span class="string"><span class="delimiter">'</span><span class="content">Date Only: </span><span class="delimiter">'</span></span>)
    dateTimePicker(<span class="key">dateVisible</span>: <span class="predefined-constant">true</span>, <span class="key">timeVisible</span>: <span class="predefined-constant">false</span>)
    label(<span class="string"><span class="delimiter">'</span><span class="content">Time Only:</span><span class="delimiter">'</span></span>)
    dateTimePicker(<span class="key">dateVisible</span>: <span class="predefined-constant">false</span>, <span class="key">timeVisible</span>: <span class="predefined-constant">true</span>)
    label(<span class="string"><span class="delimiter">'</span><span class="content">Both:</span><span class="delimiter">'</span></span>)
    dateTimePicker()
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/date_time_picker.PNG" alt="date time picker">
</div>
</div>
<div class="paragraph">
<p><code>dateTimePicker()</code> offers several bindable properties:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 7. Bindable Properties In <code>dateTimePicker()</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localDate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current value as <code>LocalDate</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current value as <code>LocalDateTime</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current value as <code>DateTime</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dateMidnight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current value as <code>DateMidnight</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current value as <code>LocalTime</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In most cases, you will need only one of those properties, but you can also bind to multiple properties to get the same
 value in different types:</p>
</div>
<div class="listingblock">
<div class="title">MyModel.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">import</span> <span class="include">org.joda.time.*</span>

<span class="type">class</span> <span class="class">MyModel</span> {

   <span class="annotation">@Bindable</span> LocalDate myLocalDate
   <span class="annotation">@Bindable</span> LocalDateTime myLocalDateTime
   <span class="annotation">@Bindable</span> DateMidnight myDateMidnight

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    dateTimePicker(
      <span class="key">localDate</span>: bind(<span class="string"><span class="delimiter">'</span><span class="content">myLocalDate</span><span class="delimiter">'</span></span>, <span class="key">target</span>: model),
      <span class="key">localDateTime</span>: bind(<span class="string"><span class="delimiter">'</span><span class="content">myLocalDateTime</span><span class="delimiter">'</span></span>, <span class="key">target</span>: model),
      <span class="key">dateMidnight</span>: bind(<span class="string"><span class="delimiter">'</span><span class="content">myDateMidnight</span><span class="delimiter">'</span></span>, <span class="key">target</span>: model)
    )
    label(<span class="string"><span class="delimiter">'</span><span class="content">myLocalDate is </span><span class="delimiter">'</span></span>)
    label(<span class="key">text</span>: bind {model.myLocalDate})
    label(<span class="string"><span class="delimiter">'</span><span class="content">myLocalDateTime is </span><span class="delimiter">'</span></span>)
    label(<span class="key">text</span>: bind {model.myLocalDateTime})
    label(<span class="string"><span class="delimiter">'</span><span class="content">myDateMidnight is </span><span class="delimiter">'</span></span>)
    label(<span class="key">text</span>: bind {model.myDateMidnight})
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/date_time_picker_binding.PNG" alt="date time picker binding">
</div>
</div>
<div class="paragraph">
<p><code>dateTimePicker()</code> internally uses <code>JXDatePicker</code> for date entry and <code>JSpinner</code> time entry.  They are exposed as properties
 called <code>datePicker</code> and <code>timeSpinner</code>.</p>
</div>
<div class="paragraph">
<p>If you want to perform a code everytime date or time is changed, you can add a closure to <code>selectedValueChanged</code> property:</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    dateTimePicker(
      <span class="key">localDateTime</span>: bind(<span class="string"><span class="delimiter">'</span><span class="content">myLocalDateTime</span><span class="delimiter">'</span></span>, <span class="key">target</span>: model),
      <span class="key">selectedValueChanged</span>: {
          println <span class="string"><span class="delimiter">&quot;</span><span class="content">Current value is </span><span class="inline"><span class="inline-delimiter">${</span>model.myLocalDateTime.toString(<span class="string"><span class="delimiter">'</span><span class="content">dd-MM-YYYY hh:mm</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
      }
    )
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="table">6.3. Table</h3>
<div class="paragraph">
<p>Table is one of the most important components in business application.  That is why simple-jpa provides its own custom
<code>JTable</code> called <code>glazedTable()</code>.  It is designed to be binded to <code>EventList</code> from Glazed Lists library.  If you don&#8217;t use
Glazed Lists, you can just use the default <code>table()</code> instead of <code>glazedTable()</code>.</p>
</div>
<div class="paragraph">
<p><code>glazedTable()</code> should contains one or more <code>glazedColumn()</code> to represent every columns in table.  Every <code>glazedColumn()</code>
will display property or execute method of the object contained in the binded <code>EventList</code>.</p>
</div>
<div class="paragraph">
<p>For example, lets assume you have created the following domain classes:</p>
</div>
<div class="listingblock">
<div class="title">Invoice.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> domain

<span class="comment">// import statements...</span>

<span class="annotation">@DomainClass</span> <span class="annotation">@Entity</span> <span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">Invoice</span> {

        <span class="annotation">@NotEmpty</span> <span class="annotation">@Size</span>(min=<span class="integer">5</span>, max=<span class="integer">5</span>)
        <span class="predefined-type">String</span> number


        <span class="annotation">@NotNull</span> <span class="annotation">@Type</span>(type=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jadira.usertype.dateandtime.joda.PersistentLocalDate</span><span class="delimiter">&quot;</span></span>)
        LocalDate date

        <span class="annotation">@ElementCollection</span> <span class="annotation">@OrderColumn</span> <span class="annotation">@NotEmpty</span>
        <span class="predefined-type">List</span>&lt;LineItem&gt; items = <span class="type">[]</span>

        <span class="type">void</span> add(LineItem item) {
                items &lt;&lt; item
        }

        <span class="predefined-type">BigDecimal</span> total() {
                items.sum { <span class="local-variable">it</span>.total() }
        }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">LineItem.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> domain

<span class="comment">// import statements...</span>

<span class="annotation">@Embeddable</span> <span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">LineItem</span> {

        <span class="annotation">@NotEmpty</span> <span class="annotation">@Size</span>(min=<span class="integer">2</span>, max=<span class="integer">50</span>)
        <span class="predefined-type">String</span> name

        <span class="annotation">@NotNull</span> <span class="annotation">@Min</span>(<span class="integer">0l</span>)
        <span class="predefined-type">BigDecimal</span> price

        <span class="annotation">@NotNull</span> <span class="annotation">@Min</span>(<span class="integer">1l</span>)
        <span class="predefined-type">BigDecimal</span> qty

        <span class="predefined-type">BigDecimal</span> total() {
                price * qty
        }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A very simple use case of <code>glazedTable()</code> will be:</p>
</div>
<div class="listingblock">
<div class="title">MyModel.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">import</span> <span class="include">org.joda.time.*</span>
<span class="keyword">import</span> <span class="include">ca.odell.glazedlists.BasicEventList</span>

<span class="type">class</span> <span class="class">MyModel</span> {

   BasicEventList myTable = <span class="keyword">new</span> BasicEventList()

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyController.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">import</span> <span class="include">domain.*</span>
<span class="keyword">import</span> <span class="include">org.joda.time.*</span>

<span class="type">class</span> <span class="class">MyController</span> {

    <span class="keyword">def</span> model
    <span class="keyword">def</span> view

    <span class="type">void</span> mvcGroupInit(<span class="predefined-type">Map</span> args) {
        Invoice invoice1 = <span class="keyword">new</span> Invoice(<span class="string"><span class="delimiter">'</span><span class="content">INV01</span><span class="delimiter">'</span></span>, LocalDate.parse(<span class="string"><span class="delimiter">'</span><span class="content">2015-01-01</span><span class="delimiter">'</span></span>))
        invoice1.add(<span class="keyword">new</span> LineItem(<span class="string"><span class="delimiter">'</span><span class="content">Product1</span><span class="delimiter">'</span></span>, <span class="integer">100</span>, <span class="integer">1</span>))
        invoice1.add(<span class="keyword">new</span> LineItem(<span class="string"><span class="delimiter">'</span><span class="content">Product2</span><span class="delimiter">'</span></span>, <span class="integer">200</span>, <span class="integer">2</span>))

        Invoice invoice2 = <span class="keyword">new</span> Invoice(<span class="string"><span class="delimiter">'</span><span class="content">INV02</span><span class="delimiter">'</span></span>, LocalDate.parse(<span class="string"><span class="delimiter">'</span><span class="content">2015-01-02</span><span class="delimiter">'</span></span>))
        invoice2.add(<span class="keyword">new</span> LineItem(<span class="string"><span class="delimiter">'</span><span class="content">Product3</span><span class="delimiter">'</span></span>, <span class="integer">300</span>, <span class="integer">3</span>))
        invoice2.add(<span class="keyword">new</span> LineItem(<span class="string"><span class="delimiter">'</span><span class="content">Product4</span><span class="delimiter">'</span></span>, <span class="integer">400</span>, <span class="integer">4</span>))

        execInsideUISync {
            model.myTable &lt;&lt; invoice1
            model.myTable &lt;&lt; invoice2
        }
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    borderLayout()
    scrollPane(<span class="key">constraints</span>: CENTER) {
      glazedTable(<span class="key">list</span>: model.myTable) {
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Invoice Number</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span>)
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Date</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>)
      }
    }
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/simple_glazed_table.PNG" alt="simple glazed table">
</div>
</div>
<div class="paragraph">
<p>As you can see, <code>name</code> attribute of <code>glazedColumn()</code> set column&#8217;s caption and <code>property</code> attribute determine the
column&#8217;s value.  The following table lists all attributes for <code>glazedColumn()</code>:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 8. Attributes for <code>glazedColumn()</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set column caption.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expression</code> or <code>exp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A closure that will be executed to evaluate every row in this column.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>property</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string to represent property that will be displayed for every row in this column.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>columnClass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Class</code> to represent the columns&#8217; class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>comparator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Comparator</code> to determine how sorting was done for this column.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>visible</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean value to determine if this column should be displayed or not.  This attribute is bindable.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>glazedColumn()</code> is an instance of <code>TableColumn</code>.  This means you can also set all of <code>TableColumn</code> public properties
such as <code>modelIndex</code>, <code>width</code>, <code>cellEditor</code>, and <code>cellRenderer</code> in <code>glazedColumn()</code>.</p>
</div>
<div class="paragraph">
<p>To retrieve column&#8217;s value based on custom calculation rather than property name, you can set a closure for <code>expression</code>
attribute.  You can also use short name <code>exp</code> instead of <code>expression</code>.  Inside this closure, <code>it</code> refer to the object
 for current row.</p>
</div>
<div class="paragraph">
<p>For example, you can add third column which values are retrieved from <code>Invoice.total()</code> method:</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    borderLayout()
    scrollPane(<span class="key">constraints</span>: CENTER) {
      glazedTable(<span class="key">list</span>: model.myTable) {
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Invoice Number</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span>)
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Date</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>)
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Total</span><span class="delimiter">'</span></span>, <span class="key">exp</span>: { <span class="local-variable">it</span>.total() })
      }
    }
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/glazed_column_expression.PNG" alt="glazed column expression">
</div>
</div>
<div class="paragraph">
<p>You can change the size of a column by using its <code>width</code> property.  If you pass a number to <code>width</code>, it will set <code>minWidth</code>,
 <code>preferredWidth</code> and <code>maxWidth</code> of current <code>TableColumn</code> to the same value.  This means user won&#8217;t be able to resize
 the column.  You can set the value for each of <code>minWidth</code>, <code>preferredWidth</code> and <code>maxWidth</code> by passing a <code>List</code> to <code>width</code>.</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    borderLayout()
    scrollPane(<span class="key">constraints</span>: CENTER) {
      glazedTable(<span class="key">list</span>: model.myTable) {
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Invoice Number</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span>, <span class="key">width</span>: <span class="integer">50</span>)
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Date</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>, <span class="key">width</span>: [<span class="integer">50</span>, <span class="integer">100</span>])
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Total</span><span class="delimiter">'</span></span>, <span class="key">exp</span>: { <span class="local-variable">it</span>.total() }, <span class="key">width</span>: [<span class="integer">50</span>, <span class="integer">100</span>, <span class="integer">200</span>])
      }
    }
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/glazed_column_width.PNG" alt="glazed column width">
</div>
</div>
<div class="paragraph">
<p>In the table above, first column is fixed and can&#8217;t be resized.  The second column can be resized to a minimum 50 pixel and
 there is no limit for its maximum size.  The third column can&#8217;t be resized to a size more than 200 pixels.</p>
</div>
<div class="paragraph">
<p><code>glazedColumn()</code> can accept instance of <code>DefaultTableHeaderRenderer</code>, <code>TableCellRenderer</code> or <code>TableCellEditor</code> as child nodes.
 The common use case is to pass a <code>TableCellRenderer</code> to <code>glazedColumn()</code> in order to format the presentation of this column.
 You can use <code>templateRenderer()</code> to create an instance of <code>TableCellRenderer</code> that supports simple-jpa template renderer
 expression.  See <a href="#template-renderer">Template Renderer</a> for more information about template renderer expression.</p>
</div>
<div class="paragraph">
<p>For example, you can add uppercase format to the first column, date format to the second column and currency format to
the third column as in the following view:</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    borderLayout()
    scrollPane(<span class="key">constraints</span>: CENTER) {
      glazedTable(<span class="key">list</span>: model.myTable) {
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Invoice Number</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span>) {
          templateRenderer(<span class="string"><span class="delimiter">'</span><span class="content">this:upperCase</span><span class="delimiter">'</span></span>)
        }
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Date</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>) {
          templateRenderer(<span class="key">exp</span>: {<span class="local-variable">it</span>?.toString(<span class="string"><span class="delimiter">'</span><span class="content">dd-MM</span><span class="delimiter">'</span></span>)?:<span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>})
        }
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Total</span><span class="delimiter">'</span></span>, <span class="key">exp</span>: { <span class="local-variable">it</span>.total() }) {
          templateRenderer(<span class="string"><span class="delimiter">'</span><span class="content">this:currencyFormat</span><span class="delimiter">'</span></span>)
        }
      }
    }
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/glazed_column_renderer.PNG" alt="glazed column renderer">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Why add <code>templateRenderer</code> while you can convert all of your column to string by using <code>exp</code> in <code>glazedColumn</code>?
 Converting all values to string is simpler, but you will loose natural ordering when sorting a column.  If you use
 <code>templateRenderer</code>, sorting a column is not performed by comparing formatted value but instead it is based on the original
 (unformatted) value.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because <code>templateRenderer()</code> generates an instance of <code>JLabel</code>, you can set public properties of resulting <code>JLabel</code> by
using their name as attribute in <code>templateRenderer()</code>.  For example, to right align the third column, you can use the following code:</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">import</span> <span class="include">static</span> <span class="include">javax.swing.SwingConstants.*</span>

application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    borderLayout()
    scrollPane(<span class="key">constraints</span>: CENTER) {
      glazedTable(<span class="key">list</span>: model.myTable) {
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Invoice Number</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span>)
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Date</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>) {
          templateRenderer(<span class="key">exp</span>: {<span class="local-variable">it</span>?.toString(<span class="string"><span class="delimiter">'</span><span class="content">dd-MM-YYYY</span><span class="delimiter">'</span></span>)?:<span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>})
        }
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Total</span><span class="delimiter">'</span></span>, <span class="key">exp</span>: { <span class="local-variable">it</span>.total() }, <span class="key">columnClass</span>: <span class="predefined-type">Integer</span>) { <i class="conum" data-value="1"></i><b>(1)</b>
          templateRenderer(<span class="string"><span class="delimiter">'</span><span class="content">this:currencyFormat</span><span class="delimiter">'</span></span>, <span class="key">horizontalAlignment</span>: RIGHT)    <i class="conum" data-value="2"></i><b>(2)</b>
        }
      }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This causes column header to be right aligned.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Right align every cell for this column.</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/glazed_column_alignment.PNG" alt="glazed column alignment">
</div>
</div>
<div class="paragraph">
<p><code>templateRenderer</code> also supports custom condition that set its property based on some conditions.  For example, the
following view will set font color for third column to red if its value is less than $1000:</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">import</span> <span class="include">static</span> <span class="include">javax.swing.SwingConstants.*</span>
<span class="keyword">import</span> <span class="include">java.awt.Color</span>

application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    borderLayout()
    scrollPane(<span class="key">constraints</span>: CENTER) {
      glazedTable(<span class="key">list</span>: model.myTable) {
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Invoice Number</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span>)
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Date</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>) {
          templateRenderer(<span class="key">exp</span>: {<span class="local-variable">it</span>?.toString(<span class="string"><span class="delimiter">'</span><span class="content">dd-MM-YYYY</span><span class="delimiter">'</span></span>)?:<span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>})
        }
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Total</span><span class="delimiter">'</span></span>, <span class="key">exp</span>: { <span class="local-variable">it</span>.total() }, <span class="key">columnClass</span>: <span class="predefined-type">Integer</span>) {
          templateRenderer(<span class="string"><span class="delimiter">'</span><span class="content">this:currencyFormat</span><span class="delimiter">'</span></span>, <span class="key">horizontalAlignment</span>: RIGHT) {
            condition(<span class="key">if_</span>: {<span class="local-variable">it</span> &lt; <span class="integer">1000</span>}, <span class="key">then_property_</span>: <span class="string"><span class="delimiter">'</span><span class="content">foreground</span><span class="delimiter">'</span></span>, <span class="key">is_</span>: <span class="predefined-type">Color</span>.RED, <span class="key">else_is_</span>: <span class="predefined-type">Color</span>.BLACK)
            condition(<span class="key">if_</span>: {isSelected}, <span class="key">then_property_</span>: <span class="string"><span class="delimiter">'</span><span class="content">foreground</span><span class="delimiter">'</span></span>, <span class="key">is_</span>: <span class="predefined-type">Color</span>.WHITE)
          }
        }
      }
    }
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/glazed_column_conditional.PNG" alt="glazed column conditional">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Using <code>condition()</code> inside <code>templateRenderer()</code> is useful for simple condition.  If you have a complex rendering
 calculation, consider creating your own implementation of <code>TableCellRenderer</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to <code>glazedColumn()</code>, <code>glazedTable()</code> also accepts <code>menuItem()</code> as child node.  This will add new menu when
 user right click on the table.  By default, popup menu for <code>glazedTable()</code> consists of only two menu items: copy cell and
 print.  The following is a sample view that add new popup menus:</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">import</span> <span class="include">static</span> <span class="include">javax.swing.SwingConstants.*</span>

actions {
  action(<span class="key">id</span>: <span class="string"><span class="delimiter">'</span><span class="content">menu1</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Menu 1</span><span class="delimiter">'</span></span>, <span class="key">closure</span>: { println <span class="string"><span class="delimiter">'</span><span class="content">Menu1 is selected</span><span class="delimiter">'</span></span> })
  action(<span class="key">id</span>: <span class="string"><span class="delimiter">'</span><span class="content">menu2</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Menu 2</span><span class="delimiter">'</span></span>, <span class="key">closure</span>: { println <span class="string"><span class="delimiter">'</span><span class="content">Menu2 is selected</span><span class="delimiter">'</span></span> })
}

application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    borderLayout()
    scrollPane(<span class="key">constraints</span>: CENTER) {
      glazedTable(<span class="key">list</span>: model.myTable) {
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Invoice Number</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span>)
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Date</span><span class="delimiter">'</span></span>, <span class="key">property</span>: <span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>) {
          templateRenderer(<span class="key">exp</span>: {<span class="local-variable">it</span>?.toString(<span class="string"><span class="delimiter">'</span><span class="content">dd-MM-YYYY</span><span class="delimiter">'</span></span>)?:<span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>})
        }
        glazedColumn(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Total</span><span class="delimiter">'</span></span>, <span class="key">exp</span>: { <span class="local-variable">it</span>.total() }, <span class="key">columnClass</span>: <span class="predefined-type">Integer</span>) {
          templateRenderer(<span class="string"><span class="delimiter">'</span><span class="content">this:currencyFormat</span><span class="delimiter">'</span></span>, <span class="key">horizontalAlignment</span>: RIGHT)
        }
        menuItem(<span class="key">action</span>: menu1)
        menuItem(<span class="key">action</span>: menu2)
      }
    }
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/glazed_table_popupmenu.png" alt="glazed table popupmenu">
</div>
</div>
<div class="paragraph">
<p>The following table lists attributes that can be used in <code>glazedTable()</code>:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 9. Attributes for <code>glazedTable()</code></caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>list</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EventList</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source value for this table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortingStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.odell.glazedlists.impl.gui.SortingStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorting strategy for this table.  If <code>list</code> is not a <code>SortedList</code> and <code>sortingStrategy</code> is not defined, <code>list</code> will
 be converted into a <code>SortedList</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onValueChanged</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Closure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This closure will be executed if table selection is changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isRowSelected</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> is row in table is selected.  This property is bindable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isNotRowSelected</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> is nothing is selected in table.  This property is bindable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tableFormat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GlazedTableFormat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GlazedTableFormat</code> used by <code>TableModel</code> in this table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>doubleClickAction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action that will be triggered when user double click a row in this table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enterKeyAction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action that will be triggered when user press Enter key while row is selected in this table.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>glazedTable()</code> creates an instance of <code>JTable</code> so you can also set any public properties of <code>JTable</code> as attribute in
 <code>glazedTable()</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="template-renderer">6.4. Template Renderer</h3>
<div class="paragraph">
<p>simple-jpa a new <code>templateRenderer</code> attribute to <code>comboBox()</code> and <code>list()</code> node to allow you customize renderer without
creating a new renderer class for every components.  <code>templateRenderer()</code> in <code>glazedColumn()</code> also uses the same thing.</p>
</div>
<div class="paragraph">
<p><code>templateRenderer</code> attribute accepts a closure or string.  If <code>templateRenderer</code> is a closure, it will be executed
  and the result is displayed.  Inside the closure, <code>it</code> refers to original value.  You can also call the following
  built-in functions from inside this closure:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 10. Built-in functions in <code>templateRenderer</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>floatFormat(v, d)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format a number using number style and limit fraction digits to <code>d</code> digits.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>numberFormat(v)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format a number using number style.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>percentFormat(v)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format a number using percent style.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>currencyFormat(v)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format a number using currency style.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lowerCase(v)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change string to lower case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upperCase(v)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change string to upper case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>titleCase(v)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change string to title case.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, the following code show how objects are displayed in <code>JComboBox</code> and <code>JList</code> without using <code>templateRenderer</code>:</p>
</div>
<div class="listingblock">
<div class="title">MyModel.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">import</span> <span class="include">ca.odell.glazedlists.*</span>
<span class="keyword">import</span> <span class="include">ca.odell.glazedlists.swing.*</span>

<span class="type">class</span> <span class="class">LatihanModel</span> {

   BasicEventList myList = <span class="keyword">new</span> BasicEventList()
   DefaultEventComboBoxModel listModel = <span class="keyword">new</span> DefaultEventComboBoxModel(myList)

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyController.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">import</span> <span class="include">domain.*</span>
<span class="keyword">import</span> <span class="include">org.joda.time.*</span>

<span class="type">class</span> <span class="class">LatihanController</span> {

    <span class="keyword">def</span> model
    <span class="keyword">def</span> view

    <span class="type">void</span> mvcGroupInit(<span class="predefined-type">Map</span> args) {
        Invoice invoice1 = <span class="keyword">new</span> Invoice(<span class="string"><span class="delimiter">'</span><span class="content">inv01</span><span class="delimiter">'</span></span>, LocalDate.parse(<span class="string"><span class="delimiter">'</span><span class="content">2015-01-01</span><span class="delimiter">'</span></span>))
        invoice1.add(<span class="keyword">new</span> LineItem(<span class="string"><span class="delimiter">'</span><span class="content">Product1</span><span class="delimiter">'</span></span>, <span class="integer">100</span>, <span class="integer">1</span>))
        invoice1.add(<span class="keyword">new</span> LineItem(<span class="string"><span class="delimiter">'</span><span class="content">Product2</span><span class="delimiter">'</span></span>, <span class="integer">200</span>, <span class="integer">2</span>))

        Invoice invoice2 = <span class="keyword">new</span> Invoice(<span class="string"><span class="delimiter">'</span><span class="content">inv02</span><span class="delimiter">'</span></span>, LocalDate.parse(<span class="string"><span class="delimiter">'</span><span class="content">2015-01-02</span><span class="delimiter">'</span></span>))
        invoice2.add(<span class="keyword">new</span> LineItem(<span class="string"><span class="delimiter">'</span><span class="content">Product3</span><span class="delimiter">'</span></span>, <span class="integer">300</span>, <span class="integer">3</span>))
        invoice2.add(<span class="keyword">new</span> LineItem(<span class="string"><span class="delimiter">'</span><span class="content">Product4</span><span class="delimiter">'</span></span>, <span class="integer">400</span>, <span class="integer">4</span>))

        execInsideUISync {
            model.myList &lt;&lt; invoice1
            model.myList &lt;&lt; invoice2
        }
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    comboBox(<span class="key">model</span>: model.listModel)
    list(<span class="key">model</span>: model.listModel)
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/normal_combobox_and_list.PNG" alt="normal combobox and list">
</div>
</div>
<div class="paragraph">
<p>Here is what it looks like after adding <code>templateRenderer</code> in view:</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    flowLayout()
    comboBox(<span class="key">model</span>: model.listModel, <span class="key">templateRenderer</span>: { <span class="local-variable">it</span>.number })
    list(<span class="key">model</span>: model.listModel, <span class="key">templateRenderer</span>: { <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">it</span>.number<span class="inline-delimiter">}</span></span><span class="content"> Qty: </span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">it</span>.items.size()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> })
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/combobox_and_list_with_template_renderer.PNG" alt="combobox and list with template renderer">
</div>
</div>
<div class="paragraph">
<p>You can also pass a string to <code>templateRenderer</code>.  The string can be a property name or method call.  If it is a method call,
 it should be starts with <code>'#'</code> character.  You can also call built-in functions by adding <code>':'</code> followed by  a function name.</p>
</div>
<div class="listingblock">
<div class="title">MyView.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">import</span> <span class="include">static</span> <span class="include">javax.swing.SwingConstants.*</span>

application(<span class="key">pack</span>: <span class="predefined-constant">true</span>) {
    borderLayout()
    scrollPane(<span class="key">constraints</span>: CENTER) {
      list(<span class="key">model</span>: model.listModel, <span class="key">templateRenderer</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">#total:currencyFormat</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/combobox_and_list_with_string_template_renderer.PNG" alt="combobox and list with string template renderer">
</div>
</div>
</div>
<div class="sect2">
<h3 id="dialog-utils">6.5. Dialog Utils</h3>
<div class="paragraph">
<p>simple-jpa provides <code>mvcPopupButton()</code> as a helper node to create a <code>JButton</code> that will display a modal dialog if it is
clicked.  The following steps will be performed if <code>mvcPopupButton()</code> is clicked:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new temporary MVC group specified by its <code>mvcGroup</code> attribute.  If <code>args</code> is closure, execute <code>args</code> and pass it
as arguments for the new MVC group.</p>
</li>
<li>
<p>If <code>onBeforeDisplay</code> is specified, call it.  The generated button and <code>args</code> will be passed as arguments for <code>onBeforeDisplay</code>.</p>
</li>
<li>
<p>Find a <code>JPanel</code> called <code>mainPanel</code> in view and display it in a modal dialog.  It is a convension that all main panel should
be named <code>mainPanel</code>.</p>
</li>
<li>
<p>If <code>onFinish</code> is specified, when user closed the modal dialog, <code>onFinish</code> will be executed.  Temporary model, view, and
controller is passed as arguments for <code>onFinish</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code show how to use <code>mvcPopupButton()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">mvcPopupButton(<span class="key">text</span>: <span class="string"><span class="delimiter">'</span><span class="content">Click Me!</span><span class="delimiter">'</span></span>, <span class="key">mvcGroup</span>: <span class="string"><span class="delimiter">'</span><span class="content">anotherMVCGroup</span><span class="delimiter">'</span></span>, <span class="key">dialogProperties</span>:
  [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">New Dialog</span><span class="delimiter">'</span></span>, <span class="key">size</span>: <span class="keyword">new</span> <span class="predefined-type">Dimension</span>(<span class="integer">900</span>,<span class="integer">420</span>)], <span class="key">onFinish</span>: { m, v, c -&gt;
     println m.result
  }
)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mvcPopupButton()</code> relies to <code>DialogUtils</code> to create modal dialog.  The following is lists of all available methods in <code>DialogUtils</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>showMVCGroup(MVCGroup mvcGroup, GriffonView view, Map dialogProperties = [:], LayerUI layerUI = null, Closure onFinish = null)</code></p>
<div class="paragraph">
<p>Use this method to display view from existing MVC group instance in modal dialog.</p>
</div>
</li>
<li>
<p><code>showMVCGroup(String mvcGroupName, Map args = [:], GriffonView view, Map dialogProperties = [:], LayerUI layerUI, Closure onFinish = null)</code></p>
<div class="paragraph">
<p>This method creates a temporary MVC group instance and display its view in modal dialog.  Use this method if you need to pass an <code>LayerUI</code>.</p>
</div>
</li>
<li>
<p><code>showMVCGroup(String mvcGroupName, Map args = [:], GriffonView view, Map dialogProperties = [:], Closure onFinish = null)</code></p>
<div class="paragraph">
<p>This method creates a temporary MVC group instance and display its view in modal dialog.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">def</span> args = [<span class="key">parentList</span>: model.items]
<span class="keyword">def</span> props = [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Items</span><span class="delimiter">'</span></span>]
DialogUtils.showMVCGroup(<span class="string"><span class="delimiter">'</span><span class="content">lineItemAsChild</span><span class="delimiter">'</span></span>, args, view, props) { m, v, c -&gt;
  model.items.clear()
  model.items.addAll(m.lineItemList)
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>showAndReuseMVCGroup(String mvcGroupName, Map args = [:], GriffonView view, Map dialogProperties = [:], LayerUI layerUI = null, Closure onFinish = null)</code></p>
<div class="paragraph">
<p>This method creates a new MVC group instance and display its view in modal dialog.  The created MVC group instance won&#8217;t be destroyed.</p>
</div>
</li>
<li>
<p><code>confirm(Component parent, String message, String title, int messageType = JOptionPane.QUESTION_MESSAGE)</code></p>
<div class="paragraph">
<p>Display a confirmation message and returns <code>true</code> if user confirms the dialog.  This method always run in EDT.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">if</span> (!DialogUtils.confirm(view.mainPanel, <span class="string"><span class="delimiter">'</span><span class="content">Do you want to continue?</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Delete Confirmation</span><span class="delimiter">'</span></span>)) {
    <span class="keyword">return</span>
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>message(Component parent, String message, String title, int messageType = JOptionPane.INFORMATION_MESSAGE)</code></p>
<div class="paragraph">
<p>Display message dialog.  This method always run in EDT.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">DialogUtils.message(<span class="predefined-constant">null</span>, errorMessage, <span class="string"><span class="delimiter">'</span><span class="content">Error</span><span class="delimiter">'</span></span>, <span class="predefined-type">JOptionPane</span>.ERROR_MESSAGE)</code></pre>
</div>
</div>
</li>
<li>
<p><code>input(Component parent, String message, String title, int messageType = JOptionPane.QUESTION_MESSAGE)</code></p>
<div class="paragraph">
<p>Display input dialog and return user input as string.  This method always run in EDT.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="predefined-type">String</span> updatedScore = DialogUtils.input(view.mainPanel, <span class="string"><span class="delimiter">'</span><span class="content">Please Enter your new score:</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">New Score</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transaction">7. Transaction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>simple-jpa uses <code>EntityManager</code> per transaction strategy.  A new <code>EntityManager</code> is created when transaction begins and
  it is destroyed when transaction is finished.  Using <code>EntityManager</code> in Griffon is a bit tricky since <code>EntityManager</code>
  is not thread-safe while Griffon may execute code in different thread.  To solve this problem, simple-jpa creates
  a new <code>EntityManager</code> for each different threads.</p>
</div>
<div class="sect2">
<h3 id="transaction-annotation">7.1. @Transaction Annotation</h3>
<div class="paragraph">
<p>You can use <code>@Transaction</code> annotation to wrap a method in transaction.  This annotation should only be used on artifacts
 that have been injected by <a href="#persistence-methods">Persistence Methods</a>.  Using <code>@Transaction</code> on artifacts that don&#8217;t have persistence methods
  will raise errors.</p>
</div>
<div class="paragraph">
<p>The following code show the basic usage of <code>@Transaction</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">MyRepository</span> {

  <span class="annotation">@Transaction</span>
  <span class="type">void</span> register() {
   ...
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also apply <code>@Transaction</code> to all methods in the class by simply add the annotation at class level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@Transaction</span>
<span class="type">class</span> <span class="class">MyRepository</span> {

  <span class="type">void</span> register() {
     ...
  }

  <span class="type">void</span> unregister() {
     ...
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Transaction</code> accepts a value that can be <code>Policy.NORMAL</code> or <code>Policy.SKIP</code>.</p>
</div>
<div class="paragraph">
<p><code>Policy.NORMAL</code> (default value) supports nested transaction.  If <code>methodA()</code> calls <code>methodB()</code> and both methods
are annotated by <code>@Transaction</code>, they are executed in the same transaction.  If one of <code>methodA()</code> and <code>methodB()</code>
raises an <code>Exception</code>, none of their queries will be committed.</p>
</div>
<div class="listingblock">
<div class="title">MyRepository.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@Transaction</span>
<span class="type">class</span> <span class="class">MyRepository</span> {

    <span class="type">void</span> methodA() {
        MyEntity entityA = <span class="keyword">new</span> MyEntity(<span class="string"><span class="delimiter">'</span><span class="content">Entity A</span><span class="delimiter">'</span></span>)
        persist(entityA)
        methodB()
    }

    <span class="type">void</span> methodB() {
        MyEntity entityB = <span class="keyword">new</span> MyEntity(<span class="string"><span class="delimiter">'</span><span class="content">Entity B</span><span class="delimiter">'</span></span>)
        persist(entityB)
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">'</span><span class="content">Something fails here!</span><span class="delimiter">'</span></span>)
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyController.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">MyController</span> {

    MyRepository myRepository

    <span class="keyword">def</span> test = {
        <span class="comment">// Both entityA and entityB are not persisted to database</span>
        <span class="comment">// because methodB() fails with Exception.</span>
        myRepository.methodA()
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nested transaction only work if methods are called from within the same thread.  If <code>methodB()</code> is executed by using
method such as <code>app.execFuture()</code> or <code>app.eventAsync()</code>, simple-jpa can&#8217;t guarantee it will be part of caller
transaction.  This is especially true if thread pool is involved.</p>
</div>
<div class="listingblock">
<div class="title">MyRepository.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@Transaction</span>
<span class="type">class</span> <span class="class">MyRepository</span> {

    <span class="keyword">def</span> app

    <span class="type">void</span> methodA() {
        MyEntity entityA = <span class="keyword">new</span> MyEntity(<span class="string"><span class="delimiter">'</span><span class="content">Entity A</span><span class="delimiter">'</span></span>)
        persist(entityA)
        app.execFuture { methodB() }
    }

    <span class="type">void</span> methodB() {
        MyEntity entityB = <span class="keyword">new</span> MyEntity(<span class="string"><span class="delimiter">'</span><span class="content">Entity B</span><span class="delimiter">'</span></span>)
        persist(entityB)
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">'</span><span class="content">Something fails here!</span><span class="delimiter">'</span></span>)
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MyController.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">MyController</span> {

    MyRepository myRepository

    <span class="keyword">def</span> test = {
        <span class="comment">// entityA is persisted to database but</span>
        <span class="comment">// entityB is *NOT* persisted to database!</span>
        myRepository.methodA()
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
To avoid unexpected random errors such as duplicate primary key or missing entity, don&#8217;t use multithreading
in persistence layer!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Policy.SKIP</code> is used to tell simple-jpa to not apply transaction AST transformation to the annotated method.  This can
 be useful if you use <code>@Transaction</code> at class level and want to avoid wrapping few methods in transaction.</p>
</div>
<div class="listingblock">
<div class="title">MyController.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@Transaction</span>
<span class="type">class</span> <span class="class">MyController</span> {

    MyRepository myRepository

    <span class="keyword">def</span> create = {
        <span class="comment">// Calling this closure will start a new transaction</span>
        <span class="comment">// or continue existing transaction if caller is in transaction.</span>
    }

    <span class="keyword">def</span> remove = {
        <span class="comment">// Calling this closure will start a new transaction</span>
        <span class="comment">// or continue existing transaction if caller is in transaction.</span>
    }

    <span class="annotation">@Transaction</span>(Transaction.Policy.SKIP)
    <span class="keyword">def</span> calculate = {
        <span class="comment">// Calling this closure will *NOT* start a new transaction!</span>
        <span class="comment">// If caller is in transaction, it will be part of that transaction.</span>
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="transaction-methods">7.2. Transaction Methods</h3>
<div class="paragraph">
<p>You can also create transaction without using <code>@Transaction</code> annotation.  This can be done by calling transaction methods
 manually.  Because transaction methods is part of persistence methods, they are only available in injected artifacts.  The
 following is list of transaction methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>beginTransaction()</code></p>
<div class="paragraph">
<p>Use this method to mark the beginning of new transaction.</p>
</div>
</li>
<li>
<p><code>commitTransaction()</code></p>
<div class="paragraph">
<p>Use this method to commit current transaction.  This method will destroys <code>EntityManager</code> if current transaction is not
 nested.</p>
</div>
</li>
<li>
<p><code>rollbackTransaction()</code></p>
<div class="paragraph">
<p>Use this method to rollback current transaction.  This method will destroys <code>EntityManager</code>.</p>
</div>
</li>
<li>
<p><code>withTransaction(closure)</code></p>
<div class="paragraph">
<p>Execute closure inside transaction.  Inside this closure, you can directly call persistence methods.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if controllers are injected with persistence methods, you can use the following code to create new transaction:</p>
</div>
<div class="listingblock">
<div class="title">MyController.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">MyController</span> {

  <span class="keyword">def</span> save = {
    beginTransaction()
      <span class="keyword">try</span> {
        ... <span class="comment">// perform works here</span>
        commitTransaction()
      } <span class="keyword">catch</span> (<span class="exception">Exception</span> ex) {
        rollbackTransaction()
      }
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>withTransaction()</code> allows you to wrap a closure inside transaction.  For example, you can replace the previous sample
code into:</p>
</div>
<div class="listingblock">
<div class="title">MyController.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">MyController</span> {

  <span class="keyword">def</span> save = {
    withTransaction {
      ... <span class="comment">// perform works here</span>
    }
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can always call persistence methods directly inside the closure.  This is very useful if you call <code>withTransaction</code>
 from another class, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">MyDomainClass</span> {

   MyRepository myRepository

   <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> calculate() {
      ...
      myRepository.withTransaction {
         ...
         executeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">FROM Invoice i WHERE i.dueDate &gt; :date</span><span class="delimiter">&quot;</span></span>, aDate)
         ...
      }
      ...
   }

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="auditing">8. Auditing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="auditable-domain-class">8.1. Auditable Domain Class</h3>
<div class="paragraph">
<p>Classes annotated by <code>@DomainClass</code> will automatically have the following auditing properties:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 11. Auditing Properties In Domain Class</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createdDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createdBy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modifiedDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modifiedBy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To disable automatic creation of auditing properties for a domain class, use <code>excludeAuditing</code> property.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@Entity</span> <span class="annotation">@DomainClass</span>(excludeAuditing=<span class="predefined-constant">true</span>) <span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">Customer</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value for auditing properties are set by JPA entity listener <code>simplejpa.AuditingEntityListener</code>.  <a href="#create-simple-jpa">create-simple-jpa</a>
command by default will create <code>griffon-app/conf/metainf/orm.xml</code> to register <code>simplejpa.AuditingEntityListener</code> as default entity listener.
The default content of generated <code>orm.xml</code> is:</p>
</div>
<div class="listingblock">
<div class="title">griffon-app/conf/metainf/orm.xml</div>
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;entity-mappings</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence/orm</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence/orm orm_2_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;persistence-unit-metadata&gt;</span>
    <span class="tag">&lt;persistence-unit-defaults&gt;</span>
        <span class="tag">&lt;entity-listeners&gt;</span>
            <span class="tag">&lt;entity-listener</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simplejpa.AuditingEntityListener</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/entity-listeners&gt;</span>
    <span class="tag">&lt;/persistence-unit-defaults&gt;</span>
<span class="tag">&lt;/persistence-unit-metadata&gt;</span>

<span class="tag">&lt;/entity-mappings&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
You can completely disable auditing by removing the line that register <code>simplejpa.AuditingEntityListener</code> in <code>orm.xml</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also register your own custom JPA Entity Listener in <code>orm.xml</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Built-in scaffolding&#8217;s generator will generate views that has auditing properties in them.  By default, generated views display
<code>java.util.Date</code> by its string representation such as <code>Wed Aug 20 13:09:11 ICT 2014</code>.  To display <code>java.util.Date</code> by using
a custom formatter, style for both date and time can be specified in <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon.simplejpa.scaffolding.dateTimeStyle = <span class="string"><span class="delimiter">'</span><span class="content">MEDIUM</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration above will generate the following code in controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">def</span> selectionChanged = {
   ...
   model.created = selected.createdDate?<span class="predefined-type">DateFormat</span>.getDateTimeInstance(<span class="predefined-type">DateFormat</span>.MEDIUM, <span class="predefined-type">DateFormat</span>.MEDIUM).format(selected.createdDate):<span class="predefined-constant">null</span>
   model.modified = selected.modifiedDate?<span class="predefined-type">DateFormat</span>.getDateTimeInstance(<span class="predefined-type">DateFormat</span>.MEDIUM, <span class="predefined-type">DateFormat</span>.MEDIUM).format(selected.modifiedDate):<span class="predefined-constant">null</span>
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is list of available styles (see <a href="http://docs.oracle.com/javase/tutorial/i18n/format/dateFormat.html">http://docs.oracle.com/javase/tutorial/i18n/format/dateFormat.html</a> for more information):</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 12. Possible Values for Date Time Style Configuration</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Style</th>
<th class="tableblock halign-left valign-top">Sample Value in U.S. Locale</th>
<th class="tableblock halign-left valign-top">Sample Value in French Locale</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEFAULT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jun 30, 2009 7:03:47 AM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 juin 2009 07:03:47</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHORT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6/30/09 7:03 AM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30/06/09 07:03</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEDIUM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jun 30, 2009 7:03:47 AM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 juin 2009 07:03:47</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LONG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">June 30, 2009 7:03:47 AM PDT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 juin 2009 07:03:47 PDT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FULL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tuesday, June 30, 2009 7:03:47 AM PDT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mardi 30 juin 2009 07 h 03 PDT</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
You can always change the generated code to use any custom formatter.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="logged-user">8.2. Logged User</h3>
<div class="paragraph">
<p>simple-jpa expects the value of current user is stored in <code>SimpleJpaUtil.user</code>.  Value for this property must be an
an implementation of <code>AuditableUser</code>.  For example, developer can create a domain class that implement <code>AuditableUser</code> such as:</p>
</div>
<div class="listingblock">
<div class="title">User.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> domain

<span class="keyword">import</span> ...

<span class="annotation">@DomainClass</span> <span class="annotation">@Entity</span> <span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">User</span> <span class="directive">implements</span> AuditableUser {

    <span class="annotation">@NotEmpty</span> <span class="annotation">@Size</span>(min=<span class="integer">2</span>, max=<span class="integer">50</span>)
    <span class="predefined-type">String</span> name

    <span class="annotation">@Override</span>
    <span class="predefined-type">String</span> getUserName() {
        <span class="keyword">return</span> name
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code can be used to set current (logged) user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">User user = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">'</span><span class="content">guest</span><span class="delimiter">'</span></span>)
SimpleJpaUtil.instance.user = user</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above will set <code>createdBy</code> and <code>modifiedBy</code> of new entity or updated entity to <code>'guest'</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
You&#8217;re not required to set current user.  If <code>SimpleJpaUtil.user</code> is null, value for <code>createdBy</code> and <code>modifiedBy</code>
 will be ignored.  Regardless whether <code>SimpleJpaUtil.user</code> is available or not, <code>createdTime</code> and <code>modifiedTime</code> are always updated.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="login-dialog">8.3. Login Dialog</h3>
<div class="paragraph">
<p>simple-jpa can display a login dialog by using SwingX <code>JXLoginPane</code> at startup time.  To enable this feature, a service
that is derived from <code>org.jdesktop.swingx.auth.LoginService</code> is required.  The following is typical steps to create
 such service:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new service by using Griffon&#8217;s <code>create-service</code> command.  For example:</p>
<div class="literalblock">
<div class="content">
<pre>griffon create-service DatabaseLoginService</pre>
</div>
</div>
</li>
<li>
<p>Change the generated service (in <code>griffon-app/services</code> folder) and extends it from <code>org.jdesktop.swingx.auth.LoginService</code>.  For example:</p>
<div class="listingblock">
<div class="title">DatabaseLoginService.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> sample

<span class="keyword">import</span> <span class="include">domain.User</span>
<span class="keyword">import</span> <span class="include">org.jdesktop.swingx.auth.LoginService</span>
<span class="keyword">import</span> <span class="include">simplejpa.SimpleJpaUtil</span>

<span class="type">class</span> <span class="class">DatabaseLoginService</span> <span class="directive">extends</span> LoginService {

    <span class="annotation">@Override</span>
    <span class="type">boolean</span> authenticate(<span class="predefined-type">String</span> name, <span class="type">char</span><span class="type">[]</span> password, <span class="predefined-type">String</span> server) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">if</span> (name == <span class="string"><span class="delimiter">'</span><span class="content">jocki</span><span class="delimiter">'</span></span> &amp;&amp; <span class="keyword">new</span> <span class="predefined-type">String</span>(password) == <span class="string"><span class="delimiter">'</span><span class="content">toor</span><span class="delimiter">'</span></span>) {
            SimpleJpaUtil.instance.user = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">'</span><span class="content">jocki</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span> <span class="predefined-constant">true</span>
        }
        <span class="predefined-constant">false</span>
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you add <code>@Transaction</code> to <code>DatabaseLoginService</code> and add the following line to <code>Config.groovy</code> (See <a href="#finders-2">[finders-2]</a> for more information):</p>
</div>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon.simplejpa.finders.injectInto = [<span class="string"><span class="delimiter">'</span><span class="content">controller</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">service</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will have access to simple-jpa dynamic finders in <code>authenticate()</code> method.  Typically, you will query the requested user
from database and check if user&#8217;s password is correct.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Add the service name as value for <code>griffon.simplejpa.auditing.loginService</code> in <code>Config.groovy</code>.  For example:</p>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon.simplejpa.auditing.loginService = <span class="string"><span class="delimiter">'</span><span class="content">DatabaseLoginService</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When application is started, the following login dialog will be displayed:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/login_dialog.png" alt="login dialog">
</div>
</div>
<div class="paragraph">
<p>If user cancels the dialog, simple-jpa will terminate the application.  If user enters the correct credentials (which means
<code>LoginService.authenticate()</code> returns <code>true</code>), simple-jpa will display startup group as usual.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="finders">9. Finders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Finders are part of persistence methods that are used to retrieve JPA entities from database.  In addition to static methods,
simple-jpa also supports dynamic finder.  With dynamic finder, you can find entity based on certain pattern in method name.</p>
</div>
<div class="sect2">
<h3 id="query-methods">9.1. Query Methods</h3>
<div class="paragraph">
<p>simple-jpa injects the following query methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>executeNamedQuery(namedQuery, map, config)</code></p>
<div class="paragraph">
<p>Execute JPA named query.</p>
</div>
</li>
<li>
<p><code>executeQuery(jpql, config)</code></p>
<div class="paragraph">
<p>Execute JP QL.</p>
</div>
</li>
<li>
<p><code>executeNativeQuery(sql)</code></p>
<div class="paragraph">
<p>Execute SQL.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use named queries, you must defined them first, for example:</p>
</div>
<div class="listingblock">
<div class="title">Invoice.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="annotation">@NamedQuery</span>(name=<span class="string"><span class="delimiter">'</span><span class="content">Invoice.LargeQty</span><span class="delimiter">'</span></span>, query=<span class="string"><span class="delimiter">'''</span><span class="content">
        FROM Invoice inv LEFT JOIN inv.items i WHERE i.qty &gt; :limit
</span><span class="delimiter">'''</span></span>)
<span class="annotation">@DomainClass</span> <span class="annotation">@Entity</span> <span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">Invoice</span> {

        ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can call <code>Invoice.LargeAmount</code> by using code like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">def</span> result = myRepository.executeNamedQuery(<span class="string"><span class="delimiter">'</span><span class="content">Invoice.LargeQty</span><span class="delimiter">'</span></span>, [<span class="key">limit</span>: <span class="integer">500</span>])
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Invoices with large qty in one of their items:</span><span class="delimiter">&quot;</span></span>
println result.collect { <span class="local-variable">it</span>.number }.join(<span class="string"><span class="delimiter">'</span><span class="content">,</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Named queries are parsed when application is launched.  Although they make application startup slower, they are quick to
 serve you when you need them because they&#8217;re prepared.</p>
</div>
<div class="paragraph">
<p>As an alternative to named query, you can always directly call JP QL by using <code>executeQuery()</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">def</span> result = myRepository.executeQuery(
   <span class="string"><span class="delimiter">'</span><span class="content">FROM Invoice inv LEFT JOIN inv.items i  WHERE i.qty &gt; :limit</span><span class="delimiter">'</span></span>,
   [:], [<span class="key">limit</span>: <span class="integer">500</span>])</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Don&#8217;t forget that you can use <code>simple-jpa-console</code> script to launch Groovy console to try query methods described
 in this chapter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>JPA can hurt performance if your query return a very large result.  This is because JPA provider needs to translate
 every rows from native SQL query into object (entities).  Creating a lot of objects in a short time may leads to
 memory shortage in heap.  To avoid these problems, you can use <code>executeNativeQuery()</code> to execute SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">def</span> result = myRepository.executeNativeQuery(<span class="string"><span class="delimiter">'''</span><span class="content">
   SELECT i.number, SUM(li.qty * li.price) AS total
   FROM Invoice i
   LEFT JOIN Invoice_Items li ON li.invoice_id = i.id
   GROUP BY i.number
</span><span class="delimiter">'''</span></span>)
<span class="comment">// result is an array</span>
println result[<span class="integer">0</span>][<span class="integer">0</span>]  <span class="comment">// print first column of first record</span>
println result[<span class="integer">0</span>][<span class="integer">1</span>]  <span class="comment">// print second column of first record</span>
println result[<span class="integer">1</span>][<span class="integer">0</span>]  <span class="comment">// print first column of second record</span>
println result[<span class="integer">1</span>][<span class="integer">1</span>]  <span class="comment">// print second column of second record</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Don&#8217;t use <code>executeNativeQuery()</code> if not necessary.  Your code become prone to mismatch between query and domain
classes. If you find yourself create a lot of SQL queries, you need to consider to use native SQL approach instead of JPA.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="dynamic-finder">9.2. Dynamic Finder</h3>
<div class="paragraph">
<p>Dynamic finder works by following certain pattern in method name.  For example, if you want to select all <code>Invoice</code>, you
can call the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="predefined-type">List</span> result = myRepository.findAllInvoice()
println result.collect { <span class="local-variable">it</span>.number }.join(<span class="string"><span class="delimiter">'</span><span class="content">,</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finder starts with <code>findAll</code> always return a <code>List</code>.  If nothing is found, it returns an empty <code>List</code>.</p>
</div>
<div class="paragraph">
<p>You can add a criteria by using adding <code>by</code> to the finder followed by property name, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="predefined-type">List</span> result = myRepository.findAllInvoiceByNumber(<span class="string"><span class="delimiter">'</span><span class="content">INV02</span><span class="delimiter">'</span></span>)
println result.collect { <span class="local-variable">it</span>.number }.join(<span class="string"><span class="delimiter">'</span><span class="content">,</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to return only a single instance, drop <code>all</code> from the finder name, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">Invoice result = myRepository.findInvoiceByNumber(<span class="string"><span class="delimiter">'</span><span class="content">INV02</span><span class="delimiter">'</span></span>)
println result?.number</code></pre>
</div>
</div>
<div class="paragraph">
<p>The finder returns an instance of <code>Invoice</code> or <code>null</code> if nothing is found.</p>
</div>
<div class="paragraph">
<p>You can combine multiple criteria by using logical operator <code>and</code> and <code>or</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">myRepository.findAllInvoiceByNumberAndDate(<span class="string"><span class="delimiter">'</span><span class="content">INV02</span><span class="delimiter">'</span></span>, LocalDate.parse(<span class="string"><span class="delimiter">'</span><span class="content">2015-02-01</span><span class="delimiter">'</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous examples, you&#8217;ve searched based on equality (<code>eq</code>).  simple-jpa dynamic finders also supports different
  operators such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>greaterThanEqualTo</code> or <code>ge</code></p>
</li>
<li>
<p><code>lessThanEqualTo</code> or <code>le</code></p>
</li>
<li>
<p><code>greaterThan</code> or <code>gt</code></p>
</li>
<li>
<p><code>lessThan</code> or <code>lt</code></p>
</li>
<li>
<p><code>isNotMember</code></p>
</li>
<li>
<p><code>isNotEmpty</code></p>
</li>
<li>
<p><code>isNotNull</code></p>
</li>
<li>
<p><code>notEqual</code> or <code>ne</code></p>
</li>
<li>
<p><code>isMember</code></p>
</li>
<li>
<p><code>isEmpty</code></p>
</li>
<li>
<p><code>isNull</code></p>
</li>
<li>
<p><code>like</code></p>
</li>
<li>
<p><code>notLike</code></p>
</li>
<li>
<p><code>between</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, to search for all invoices created in this month, you can use the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">def</span> dateBegin = LocalDate.now().dayOfMonth().withMinimumValue()
<span class="keyword">def</span> dateEnd = LocalDate.now().dayOfMonth().withMaximumValue()
<span class="keyword">def</span> result = myRepository.findAllInvoiceByDateBetween(dateBegin, dateEnd)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this another example, you find products by name using <code>like</code> operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">myRepository.findAllProductByNameLike(<span class="string"><span class="delimiter">'</span><span class="content">A%</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can search for nested properties by using double underscore (<code>__</code>) as separator.  For example, the following
query finds all products based on supplier&#8217;s location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">myRepository.findAllProductBySupplier__City__NameLike(<span class="string"><span class="delimiter">'</span><span class="content">a city%</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dsl-finder">9.3. Dsl Finder</h3>
<div class="paragraph">
<p>In addition to using dynamic finder, you can also perform query by using Dsl finder.  Such finder requires a closure as
 argument.  The following code show how to use Dsl Finder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">def</span> dateBegin = LocalDate.now().dayOfMonth().withMinimumValue()
<span class="keyword">def</span> dateEnd = LocalDate.now().dayOfMonth().withMaximumValue()
myRepository.findAllInvoiceByDsl {
    number eq(<span class="string"><span class="delimiter">'</span><span class="content">INV02</span><span class="delimiter">'</span></span>)
    and()
    date between(dateBegin, dateEnd)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The advantage of using Dsl closure is you can build the query conditions based on certain condition.   You can also add
 any code inside the closure.  For example, the following code add query condition only if certain variables are not null:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">def</span> dateBeginSearch = LocalDate.now().dayOfMonth().withMinimumValue()
<span class="keyword">def</span> dateEndSearch = LocalDate.now().dayOfMonth().withMaximumValue()
<span class="keyword">def</span> numberSearch = <span class="predefined-constant">null</span>
myRepository.findAllInvoiceByDsl {
  <span class="keyword">if</span> (numberSearch) {
    number eq(numberSearch)
  }
  <span class="keyword">if</span> (dateBeginSearch &amp;&amp; dateEndSearch) {
    date between(dateBeginSearch, dateEndSearch)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use nested properties by using double underscores (<code>__</code>) as separator, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">myRepository.findAllProductByDsl {
  supplier__name isIn([<span class="string"><span class="delimiter">'</span><span class="content">supplier a</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">supplier b</span><span class="delimiter">'</span></span>])
  and()
  name eq(<span class="string"><span class="delimiter">'</span><span class="content">A product</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="named-entity-graph">9.4. Named Entity Graph</h3>
<div class="paragraph">
<p>Named entity graph is a new feature in JPA 2.1.  It allows you to define a flexible fetch graph without modifying your
current query.  For example, you can define named entity graph such as:</p>
</div>
<div class="listingblock">
<div class="title">Invoice.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="keyword">package</span> domain

<span class="comment">// import statements are not shown</span>

<span class="annotation">@NamedEntityGraph</span>(name=<span class="string"><span class="delimiter">'</span><span class="content">Invoice.Items</span><span class="delimiter">'</span></span>, attributeNodes=[
  <span class="annotation">@NamedAttributeNode</span>(<span class="string"><span class="delimiter">'</span><span class="content">items</span><span class="delimiter">'</span></span>)
])
<span class="annotation">@DomainClass</span> <span class="annotation">@Entity</span> <span class="annotation">@Canonical</span>(excludes=<span class="string"><span class="delimiter">'</span><span class="content">items</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">Invoice</span> {

  <span class="annotation">@NotEmpty</span> <span class="annotation">@Size</span>(min=<span class="integer">5</span>, max=<span class="integer">5</span>)
  <span class="predefined-type">String</span> number

  <span class="annotation">@NotNull</span> <span class="annotation">@Type</span>(type=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jadira.usertype.dateandtime.joda.PersistentLocalDate</span><span class="delimiter">&quot;</span></span>)
  LocalDate date

  <span class="annotation">@ElementCollection</span> <span class="annotation">@OrderColumn</span> <span class="annotation">@NotEmpty</span>
  <span class="predefined-type">List</span>&lt;LineItem&gt; items = <span class="type">[]</span>

  <span class="type">void</span> add(LineItem item) {
    items &lt;&lt; item
  }

  <span class="predefined-type">BigDecimal</span> total() {
    items.sum { <span class="local-variable">it</span>.total() }
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use named entity graph in simple-jpa finders, you should always start the name with domain class name
 followed by a period (<code>.</code>) before the actual name.  To use named entity graph, add <code>fetch</code> or <code>load</code> to dynamic finder,
 for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="comment">// items is lazy loaded.  It will trigger SQL query when code refer to it.</span>
<span class="comment">// result is not safe to be passed to outside transaction because</span>
<span class="comment">// SQL query is required to retrieve items.</span>
<span class="keyword">def</span> result = myRepository.findAllInvoice()

<span class="comment">// items has been loaded.</span>
<span class="comment">// anotherResult is safe to be passed to outside transaction because</span>
<span class="comment">// items is safe to read from anywhere.</span>
<span class="keyword">def</span> anotherResult = myRepository.findAllInvoiceFetchItems()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to using <code>fetch</code> in dynamic finder, you can also use named entity graph by passing them query configuration
 using <code>fetchGraph</code> or <code>loadGraph</code> as key.  See <a href="#query-configuration">Query Configuration</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="query-configuration">9.5. Query Configuration</h3>
<div class="paragraph">
<p>Most of finder methods described so far can receive a configuration parameter in form of <code>Map</code>.  You can use the following
 values as its keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>excludeSubclass</code></p>
<div class="paragraph">
<p>The value must be a string.  Normal query returns all instances of current class and its subclasses.  For example, if <code>Employee</code>
 has three subclasses <code>Teacher</code>, <code>Researcher</code>, and <code>Staff</code>, then <code>findAllEmploye()</code> returns instances of  <code>Employee</code>, <code>Teacher</code>,
 <code>Researcher</code> and <code>Staff</code>.  If you want to return only <code>Teacher</code> and <code>Staff</code>, you can use the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">myRepository.findAllEmployee([<span class="key">excludeSubclass</span>: <span class="string"><span class="delimiter">'</span><span class="content">Researcher</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming <code>Employee</code> is not an abstract class and it have instances, then you can use following code to only return instances
of <code>Employee</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">myRepository.findAllEmployee([<span class="key">excludeSubclass</span>: <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
</li>
<li>
<p><code>flushMode</code></p>
<div class="paragraph">
<p>The value must be one of <code>FlushModeType.COMMIT</code> or <code>FlushModeType.AUTO</code>.  Use this key to override flush mode for current query.</p>
</div>
</li>
<li>
<p><code>excludeDeleted</code></p>
<div class="paragraph">
<p>The value is a boolean (<code>true</code> or <code>false</code>).  If it is <code>true</code>, query will not return soft deleted entities. An entity is
considered as soft deleted if its <code>deleted</code> property is equals to <code>'Y'</code>.</p>
</div>
</li>
<li>
<p><code>orderBy</code></p>
<div class="paragraph">
<p>The value must be a string.  Use this key to sort current query.  If you have multiple attributes to sort, separate them by comma,
 for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">myRepository.findAllInvoice([<span class="key">orderBy</span>: <span class="string"><span class="delimiter">'</span><span class="content">number,date</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to sort by nested property, use double underscore (<code>__</code>) as separator.</p>
</div>
</li>
<li>
<p><code>orderDirection</code></p>
<div class="paragraph">
<p>The value must be one of the following string: <code>asc</code> or <code>desc</code>.  This key is used to specify the direction of order in <code>orderBy</code>.
For example, the following query will find all invoices sorted by number in ascending direction and date in descending direction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">myRepository.findAllInvoice([<span class="key">orderBy</span>: <span class="string"><span class="delimiter">'</span><span class="content">number,date</span><span class="delimiter">'</span></span>, <span class="key">orderDirection</span>: <span class="string"><span class="delimiter">'</span><span class="content">asc,desc</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
</li>
<li>
<p><code>page</code></p>
<div class="paragraph">
<p>The value must be a number starting from <code>1</code>.  Use this key together with <code>pageSize</code> to limit query result.  Default value for
<code>page</code> is <code>1</code>.</p>
</div>
</li>
<li>
<p><code>pageSize</code></p>
<div class="paragraph">
<p>The value must be a positive number.  Use this key to set the size for current page.  If <code>page</code> is specified but <code>pageSize</code>
 is not set, then it is assumed to be <code>10</code>.  If both <code>page</code> and <code>pageSize</code> is not specified, there will be no limit for this query.</p>
</div>
<div class="paragraph">
<p>For example, to retrieve only 3 first invoices, you can use the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">myRepository.findAllInvoice([<span class="key">pageSize</span>:<span class="integer">3</span>])</code></pre>
</div>
</div>
</li>
<li>
<p><code>allowDuplicate</code></p>
<div class="paragraph">
<p>The value is a boolean (<code>true</code> or <code>false</code>).  Set it to <code>true</code> to never returns duplicate entities.  This configuration adds
 <code>SELECT DISTINCT</code> to current query.</p>
</div>
</li>
<li>
<p><code>fetchGraph</code></p>
<div class="paragraph">
<p>This key accepts a <code>String</code> or an instance of <code>EntityGraph</code> created by using <code>entityManager.createEntityGraph()</code>.  If you
 have defined named entity graph called <code>Invoice.Items</code>, you can use it in finders like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">myRepository.findAllInvoice([<span class="key">fetchGraph</span>: <span class="string"><span class="delimiter">'</span><span class="content">Invoice.Items</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, you can also build the named entity graph in runtime such as in this sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">myRepository.withTransaction {
    <span class="keyword">def</span> em = getEntityManager()
    <span class="keyword">def</span> g = em.createEntityGraph(Invoice)
    g.addAttributeNodes(<span class="string"><span class="delimiter">'</span><span class="content">items</span><span class="delimiter">'</span></span>)
    findAllInvoice([<span class="key">fetchGraph</span>: g])
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>loadGraph</code></p>
<div class="paragraph">
<p>This key accepts a <code>String</code> or an instance of <code>EntityGraph</code> created by using <code>entityManager.createEntityGraph()</code>.  See
 the description of <code>fetchGraph</code> for more information.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also add some of the query configurations described above in <code>Config.groovy</code>.  This way the configuration is
 globally applied to all finders that can accepts it.  The following table lists all query configurations that
  can be added in <code>Config.groovy</code>:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 13. Query Configuration In <code>Config.groovy</code></caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>griffon.simplejpa.entityManager.defaultFlushMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FlushModeType.AUTO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can also change the flush mode to <code>FlushModeType.COMMIT</code> (or just <code>'COMMIT'</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>griffon.simplejpa.finders.alwaysExcludeSoftDeleted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this value is <code>true</code>, finders will not return soft deleted entities.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>griffon.simplejpa.finders.alwaysAllowDuplicate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default value always add <code>SELECT DISTINCT</code> to the generated query.  If you don&#8217;t need this feature, you can
increase performance by setting this value to <code>false</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing">10. Testing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="unit-test">10.1. Unit Test</h3>
<div class="paragraph">
<p>In unit test, you&#8217;re usually testing domain classes.  This test should never requires database connection.  Unfortunately,
 sometimes domain class may depends on persistence methods in repository, for example:</p>
</div>
<div class="listingblock">
<div class="title">InvoiceRepository.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">RegistrationRepository</span> {

  <span class="comment">// This methods hits database to retrieve last number and increase it by one.</span>
  <span class="predefined-type">Integer</span> nextNumber() {
    ...
  }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Registration.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">Registration</span> {

  <span class="predefined-type">String</span> reserveNumber(<span class="predefined-type">Integer</span> input) {
    ...
    def repo = SimpleJpaUtil.instance.repositoryManager.getRepository(<span class="string"><span class="delimiter">'</span><span class="content">RegistrationRepository</span><span class="delimiter">'</span></span>)
    <span class="keyword">def</span> number = repo.nextNumber()
    ...
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can&#8217;t test <code>Registration.reserveNumber()</code> directly because it calls <code>RegistrationRepository.nextNumber()</code> that requires
access to database.  For example, the following unit test will fail:</p>
</div>
<div class="listingblock">
<div class="title">RegistrationTests.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">RegistrationTests</span> <span class="directive">extends</span> GriffonUnitTestCase {

  <span class="type">void</span> testReserveNumber() {
      Registration r = <span class="keyword">new</span> Registration()
      assertEquals(<span class="string"><span class="delimiter">'</span><span class="content">REG-001</span><span class="delimiter">'</span></span>, r.reserveNumber(<span class="integer">1</span>))
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To solve this problem, you need to create a stub repository, for example:</p>
</div>
<div class="listingblock">
<div class="title">RegistrationTests.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">RegistrationTests</span> <span class="directive">extends</span> GriffonUnitTestCase {

  <span class="type">void</span> setUp() {
    <span class="local-variable">super</span>.setUp()
    <span class="local-variable">super</span>.registerMetaClass(NumberingRepository)
    NumberingRepository.metaClass.reserveNumber = {
        <span class="comment">// stub for reserveNumber() that always return 0.</span>
        <span class="keyword">return</span> <span class="integer">0</span>
    }
    StubRepositoryManager stubRepositories = <span class="keyword">new</span> StubRepositoryManager()
    stubRepositories.instances[<span class="string"><span class="delimiter">'</span><span class="content">NumberingRepository</span><span class="delimiter">'</span></span>] = <span class="keyword">new</span> NumberingRepository()
    SimpleJpaUtil.instance.repositoryManager = stubRepositories
  }

  <span class="type">void</span> testReserveNumber() {
    Registration r = <span class="keyword">new</span> Registration()
    assertEquals(<span class="string"><span class="delimiter">'</span><span class="content">REG-001</span><span class="delimiter">'</span></span>, r.reserveNumber(<span class="integer">1</span>))
  }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="integration-test">10.2. Integration Test</h3>
<div class="paragraph">
<p>simple-jpa provides <code>DbUnitTestCase</code> to help you in performing integration testing that actually hits database.  <code>DbUnitTestCase</code>
 uses DbUnit to populate databases with certain records for every test case.   The following sample show a basic usage of
 <code>DbUnitTestCase</code>:</p>
</div>
<div class="listingblock">
<div class="title">InvoiceTest.groovy</div>
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">InvoiceTest</span> <span class="directive">extends</span> DbUnitTestCase {

  InvoiceRepository invoiceRepository

  <span class="directive">protected</span> <span class="type">void</span> setUp() {
     <span class="local-variable">super</span>.setUp()
     setUpDatabase(<span class="string"><span class="delimiter">'</span><span class="content">/project/data.xlsx</span><span class="delimiter">'</span></span>)
     invoiceRepository = SimpleJpaUtil.instance.repositoryManager.findRepository(<span class="string"><span class="delimiter">'</span><span class="content">Invoice</span><span class="delimiter">'</span></span>)
  }

  <span class="type">void</span> testDelete() {
     Invoice newInvoice = invoiceRepository.findInvoiceById(-<span class="integer">1l</span>)
     invoiceRepository.remove(newInvoice)
     newInvoice = invoiceRepository.findInvoiceById(-<span class="integer">1l</span>)
     assertNull(newInvoice)
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you execute the test by using <code>griffon test-app</code>, <code>setUpDatabase()</code> is called before executing test methods.  By default,
  <code>setUpDatabase()</code> performs a clean insert (<code>DatabaseOperation.CLEAN_INSERT</code>) on database.  Tables contents are deleted first then
  new records are inserted based on the value in <code>/project/data.xlsx</code>.  Because this process is repeated for every test methods,
  you can assume that database is in the expected state when test methods begin.</p>
</div>
<div class="paragraph">
<p><code>DbUnitTestCase</code> supports the following format as data source:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Microsoft Excel binary format if filename ends with <code>.xls</code>.  Every sheets represents a table.  Rows are table records and columns are
table columns.</p>
</li>
<li>
<p>Microsoft Excel XML format (the newer version) if filename ends with <code>.xlsx</code>.</p>
</li>
<li>
<p>XML file if filename ends with <code>.xml</code>.</p>
</li>
<li>
<p>If <code>DbUnitTestCase</code> can&#8217;t decide the type of data source, it assumes the data source is in CSV format.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>DbUnitTestCase</code> also executes the following SQL files if it founds them in root package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>before.sql</code> is executed before cleaning and executing test method.</p>
</li>
<li>
<p><code>clean.sql</code> is executed  before inserting data to database.</p>
</li>
<li>
<p><code>after.sql</code> is executed after database has been populated.  Test method begins after this script is executed.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
To avoid problem related to foreign key constraints, you can drop your table manually in <code>before.sql</code> or <code>clean.sql</code> in
 the correct order.  If you use MySQL Server, you can use <code>SET FOREIGN_KEY_CHECKS=0</code> to disable foreign key constraints and
  <code>SET FOREIGN_KEY_CHECKS=1</code> to enable foreign key constraints.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, <code>DbUnitTestCase</code> performs <code>DatabaseOperation.CLEAN_INSERT</code> for every methods.  You can change this by setting
 <code>insertOperation</code> with a different value, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="type">class</span> <span class="class">InvoiceTest</span> <span class="directive">extends</span> DbUnitTestCase {

  <span class="directive">protected</span> <span class="type">void</span> setUp() {
     <span class="local-variable">super</span>.setUp()
     setUpDatabase(<span class="string"><span class="delimiter">'</span><span class="content">/project/data.xlsx</span><span class="delimiter">'</span></span>, <span class="predefined-constant">null</span>, <span class="predefined-constant">false</span>, DatabaseOperation.UPDATE)
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For advanced use case, you can always override or execute public methods provided by <code>DbUnitTestCase</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>loadMVC(mvcGroup)</code></p>
<div class="paragraph">
<p>Create MVCGroup instance specified by the name.  You can then use <code>model</code>, <code>view</code> and <code>controller</code> property to
access this MVC instance members.</p>
</div>
</li>
<li>
<p><code>beforeSetupDatabase()</code></p>
<div class="paragraph">
<p>Use this method to execute <code>before.sql</code> if it is found in root package.  This method is called at the beginning of test method.</p>
</div>
</li>
<li>
<p><code>cleanDataset()</code></p>
<div class="paragraph">
<p>Use this method to execute <code>clean.sql</code> if it is found in root package.  This method is called before <code>insertOperation</code> is executed.</p>
</div>
</li>
<li>
<p><code>afterSetupDatabase()</code></p>
<div class="paragraph">
<p>Use this method to execute <code>after.sql</code> if it is found in root package.  This method is called after <code>insertOperation</code> is executed and
before test method begins.</p>
</div>
</li>
<li>
<p><code>execute(list)</code></p>
<div class="paragraph">
<p>Execute a list of SQL statements.</p>
</div>
</li>
<li>
<p><code>cleanInsert()</code></p>
<div class="paragraph">
<p>Perform a <code>DatabaseOperation.CLEAN_INSERT</code> based on current data source.</p>
</div>
</li>
<li>
<p><code>truncateTable()</code></p>
<div class="paragraph">
<p>Perform a <code>DatabaseOperation.TRUNCATE_TABLE</code> based on current data source.</p>
</div>
</li>
<li>
<p><code>deleteAll()</code></p>
<div class="paragraph">
<p>Perform a <code>DatabaseOperation.DELETE_ALL</code> based on current data source.</p>
</div>
</li>
<li>
<p><code>refresh()</code></p>
<div class="paragraph">
<p>Perform a <code>DatabaseOperation.REFRESH</code> based on current data source.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="script">Appendix A: Script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>simple-jpa scripts can be called just like any Griffon&#8217;s commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon [command-name] [argument1] [argument2] ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>To display more information for a command, call it with <code>-info</code> argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon [command-name] -info</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="create-simple-jpa">A.1. create-simple-jpa</h3>
<div class="paragraph">
<p>This command is usually the first command that will be invoked before working with Java Persistence API (JPA).
It will create persistence.xml and orm.xml in current project. It will also create some resource files that are commonly
required when working with JPA.</p>
</div>
<div class="paragraph">
<p>The syntax for this command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>create-simple-jpa -user=[databaseUser] -password=[databasePassword]
    -database=[databaseName] -rootPassword=[databaseRootPassword]
    -provider=[JPAProvider] -jdbc=[databaseType]</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>create-simple-jpa -user=[databaseUser] -password=[databasePassword]
    -database=[databaseName] -provider=[JPAProvider]
    -jdbc=[databaseType] -skipDatabase</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>user</code></dt>
<dd>
<p>The name of database user. JPA will establish connection to database by using the specified user name. If user name
doesn&#8217;t exists, it will be created automatically.</p>
</dd>
<dt class="hdlist1"><code>password</code></dt>
<dd>
<p>The password used when establishing connection to the database.</p>
</dd>
<dt class="hdlist1"><code>database</code></dt>
<dd>
<p>The database name or schema name. If this database doesn&#8217;t exists, it will be created automatically.
The specified user will also be granted privilleges to use this database.</p>
</dd>
<dt class="hdlist1"><code>rootPassword</code></dt>
<dd>
<p>The password for database root/administrator. To create user and database and grants privilleges, this command requires
password for root/administrator user. This value will never be stored in project files.</p>
</dd>
<dt class="hdlist1"><code>provider</code></dt>
<dd>
<p>The name of JPA provider that will be used. The default value for this parameter is <code>hibernate</code>.</p>
</dd>
<dt class="hdlist1"><code>jdbc</code></dt>
<dd>
<p>The name of JDBC driver that will be used. The default value for this parameter is <code>mysql</code>. The following available
values are <code>mysql</code> for using MySQL JDBC or <code>derby-embedded</code> for using Apache Derby embedded database JDBC.</p>
</dd>
<dt class="hdlist1"><code>skipDatabase</code></dt>
<dd>
<p>If this argument exists, <code>create-simple-jpa</code> will not create user and database automatically. It will only write
to <code>persistence.xml</code> and assume required database schema and user is available.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example, the following command will generate <code>persistence.xml</code> with a connection to MySQL database
(user: steven, password: 12345, database schema: sample), uses Hibernate JPA, and creates user steven and sample schema
if they are not exists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon create-simple-jpa -user=steven -password=12345 -database=sample
    -rootPassword=secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following command will do the same as the previous one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon create-simple-jpa -user=steven -password=12345 -database=sample
    -provider=hibernate -jdbc=mysql -rootPassword=secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following command will generate <code>persistence.xml</code> with a connection to MySQL database (user: scott, password: tiger,
database schema: ha), uses Hibernate JPA, and will not check if required user and schema are available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon create-simple-jpa -user=scott -password=tiger -database=ha
    -skip-database</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code>-jdbc=derby-embedded</code>, <code>-database</code> should be a full path to directory such as
<em>C:/Users/me/mydb</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-domain-class">A.2. create-domain-class</h3>
<div class="paragraph">
<p>This command will create a new empty domain class and register it in persistence context file. Before creating domain
class, the project must has <code>persistence.xml</code> file in <code>metainf</code> directory. To generate required files for working with
JPA, use <code>create-simple-jpa</code> command.</p>
</div>
<div class="paragraph">
<p>Domain class will be generated in the package specified by <code>griffon.simplejpa.model.package</code> value. The default package
is <code>domain</code>.</p>
</div>
<div class="paragraph">
<p>To change the default template used for generating domain clasess, execute <code>install-templates</code> command and edit
<code>SimplaJpaDomainClass.groovy</code>.</p>
</div>
<div class="paragraph">
<p>The syntax for this command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>create-domain-class [domainClassName]</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>create-domain-class [domainClassName] [domainClassName] ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>create-domain-class [domainClassName],[domainClassName], ...</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>domainClassName</code></dt>
<dd>
<p>The name of domain class that will be generated.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon create-domain-class Student</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon create-domain-class Teacher Student</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon create-domain-class Teacher,Student</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="generate-all">A.3. generate-all</h3>
<div class="paragraph">
<p>This command will create a new <code>MVCGroup</code> based on a domain class. The generated MVCGroup (consists of a view, a model
and a controller) has the ability to perform CRUD operations on a domain class. This command can also generate a startup
<code>MVCGroup</code> that act as container for the others.</p>
</div>
<div class="paragraph">
<p>Domain classes should be located in the package specified by <code>griffon.simplejpa.model.package</code> in <code>Config.groovy</code>. The
default value for package is <code>domain</code>.</p>
</div>
<div class="paragraph">
<p>When the value of <code>griffon.simplejpa.finders.alwaysExcludeSoftDeleted</code> is <code>true</code>, the generated controller will call
<code>softDelete()</code> instead of <code>remove()</code>.</p>
</div>
<div class="paragraph">
<p>To change the default template used by this command, execute <code>install-templates</code> command and edit the generated template
files.</p>
</div>
<div class="paragraph">
<p>The syntax for this command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>generate-all * [-generatedPackage] [-forceOverwrite] [-setStartup]
    [-skipExcel] [-startupGroup=value]</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon generate-all [domainClassName] [-generatedPackage]
    [-forceOverwrite] [-setStartup] [-skipExcel]
    [-startupGroup=value]</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>generate-all [domainClassName] [domainClassName] ...
    [-generatedPackage] [-forceOverwrite] [-setStartup] [-skipExcel]
    [-startupGroup=value]</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>domainClassName</code></dt>
<dd>
<p>The name of domain class the will be manipulated by the generated <code>MVCGroup</code>. Each domain class
will have their own <code>MVCGroup</code> generated. If this value is <code>*</code>, then all domain classes will be processed.</p>
</dd>
<dt class="hdlist1"><code>generatedPackage</code> (optional)</dt>
<dd>
<p>The target package. By default, the value for this parameter is project.</p>
</dd>
<dt class="hdlist1"><code>forceOverwrite</code> (optional)</dt>
<dd>
<p>If exists, this script will replace existing files without any notifications.</p>
</dd>
<dt class="hdlist1"><code>setStartup</code> (optional)</dt>
<dd>
<p>If exists, this script will set the generated MVCGroup as startup (the <code>MVCGroup</code> will be launched when program starts).
If this argument is present when generating more than one MVCGroup, then only the last MVCGroup will be set as startup
group.</p>
</dd>
<dt class="hdlist1"><code>skipExcel</code> (optional)</dt>
<dd>
<p>If exists, this script will not create Microsoft Excel file for integration testing (DbUnit).</p>
</dd>
<dt class="hdlist1"><code>startupGroup</code> (optional)</dt>
<dd>
<p>The name for MVCGroup that serves as startup group. The generated MVCGroup will not based on any domain class, instead
it will act as a container for the other domain classes&#8217; based MVCGroups.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example, the following command will generate MVCGroup for all domain classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon generate-all *</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following command will generate MVCGroup for all domain classes, overwriting existing files, and set the last
MVCGroup as startup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon generate-all * -forceOverwrite -setStartup</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following command will generate MVCGroup for domain class <code>Student</code>, <code>Teacher</code>, and <code>Classroom</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon generate-all Student Teacher Classroom</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following command will generate MVCGroup for domain class <code>Student</code> and generate a container MVCGroup which name is
<code>MainGroup</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon generate-all Student -startupGroup=MainGroup</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following command will generate a container MVCGroup which name is <code>MainGroup</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon generate-all -startupGroup=MainGroup</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="install-templates">A.4. install-templates</h3>
<div class="paragraph">
<p>This command will add templates used by simple-jpa to current project in <code>/src/templates/artifacts</code>. This command is
useful for changing templates that is used by simple-jpa generator. Developer can edit the templates and the next
invocation of simple-jpa generator will based on them.</p>
</div>
<div class="paragraph">
<p>The syntax for this command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>install-templates</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon install-templates</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="simple-jpa-console">A.5. simple-jpa-console</h3>
<div class="paragraph">
<p>This command will launch Groovy Console loaded with Griffon and simple-jpa. Developer can use this command to test or
execute code interactively.</p>
</div>
<div class="paragraph">
<p>For each loaded MVCGroup, there are three variables to refer to its model, view, and controller. For example, if
MVCGroup name is <code>student</code>, developer can refer to its model, view, or controller by using the following variables:
<code>studentModel</code>, <code>studentController</code> and <code>studentView</code>. Developer can also use <code>app</code> to refer to GriffonApplication.
To display list of available variables, select <strong>Script</strong>, <strong>Inspect Variables</strong>.</p>
</div>
<div class="paragraph">
<p>When console is started, it only loads startup MVCGroup. To load the another MVCGroup, select <strong>simple-jpa</strong>, <strong>MVCGroups</strong>.</p>
</div>
<div class="paragraph">
<p>The syntax for this command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>simple-jpa-console</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon simple-jpa-console</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="generate-schema">A.6. generate-schema</h3>
<div class="paragraph">
<p>This command will generate database schema based on current domain models mapping to database or scripts. Developer can
use this command to retrieve SQL scripts that can be used to populate new database schema for current application.</p>
</div>
<div class="paragraph">
<p>The syntax for this command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>generate-schema -target=database -action=[action]</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>generate-schema -target=database -action=[action] -data=[script.sql]</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>generate-schema -target=script -action=[action]
                -dropTarget=[script.sql]
                -createTarget=[script.sql]</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>target</code></dt>
<dd>
<p>One of <code>database</code> or <code>script</code>. If target is <code>database</code>, this script will create database objects in the database
configured in <code>persistence.xml</code>. You shouldn&#8217;t need this target because by default, database objects will be dropped and
generated when application is launched. If target is <code>script</code>, this command will generate SQL scripts that can be
executed later (perhaps in a new database schema).</p>
</dd>
<dt class="hdlist1"><code>action</code></dt>
<dd>
<p>Valid values are <code>none</code>, <code>create</code>, <code>drop-and-create</code>, and <code>drop</code>.</p>
</dd>
<dt class="hdlist1"><code>data</code> (optional)</dt>
<dd>
<p>Contains SQL script location that will be executed after database objects are created. The purpose of this script is to
initialize database (for example, populating tables with initial data).</p>
</dd>
<dt class="hdlist1"><code>dropTarget</code></dt>
<dd>
<p>Available if <code>target</code> is <code>script</code>. This is the value of file that will be generated and contains DDL DROP scripts.</p>
</dd>
<dt class="hdlist1"><code>createTarget</code></dt>
<dd>
<p>Available if <code>target</code> is <code>script</code>. This is the value of file that will be generated and contains DDL CREATE scripts.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon generate-schema -target=database -action=drop-and-create</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon generate-schema -target=script -action=drop-and-create
                        -dropTarget=drop.sql -createTarget=target.sql</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="obfuscate">A.7. obfuscate</h3>
<div class="paragraph">
<p>Use this command to generate obfuscated value that can be added to configuration file or simplejpa.properties. This is
useful to hide sensitive information such as database password from novice users.</p>
</div>
<div class="paragraph">
<p>The syntax for this command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>obfuscate -generate=[value]</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>obfuscate -reverse=[value]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>griffon obfuscate -generate=mypassword</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command above will generate <code>obfuscated:AGHJLPazOUvt5ZjzRNnKaA==</code>. This can be used as a substitution for
configurations that accepts string value. For example, it can be used in <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">griffon {
   simplejpa {
      entityManager {
         javax.persistence.jdbc.password = <span class="string"><span class="delimiter">&quot;</span><span class="content">obfuscated:AGHJLPazOUvt5ZjzRNnKaA==</span><span class="delimiter">&quot;</span></span>
      }
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-repository">A.8. create-repository</h3>
<div class="paragraph">
<p>Use this command to create a new repository.  It is recommended to generate repository automatically by using
DDD generator rather than create them manually using this command.</p>
</div>
<div class="paragraph">
<p>The syntax for this command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>create-repository [name]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will create new repository class in <code>griffon-app/repositories</code>.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code>create-repository Invoice</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-02-02 13:28:54 ICT
</div>
<div id="mask"></div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
try {
  var pageTracker = _gat._getTracker("UA-41202290-1");
  pageTracker._trackPageview();
} catch(err) {}
var navIcon = document.getElementById('nav-icon');
var toc = document.getElementById('toc');
var mask = document.getElementById('mask');
function navIconClick() {
    toc.style.visibility = 'visible';
    mask.style.visibility = 'visible';
    document.body.style.overflow = 'hidden';
}
function hideToc() {
    toc.style.visibility = 'hidden';
    mask.style.visibility = 'hidden';
    document.body.style.overflow = 'auto'
}
navIcon.addEventListener('click', navIconClick);
toc.addEventListener('click', hideToc);
mask.addEventListener('click', hideToc);
</script>
</div>
</body>
</html>